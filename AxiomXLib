--[[
    AxiomXLib v3.0 - Biblioteca de UI Final
    Criador: AxiomX
    Recursos: Windows, Tabs, Sections, Button, Toggle, Slider, Dropdown, Keybinds, Notifications, Themes, Drag & Touch
--]]

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")

local Library = {}
Library.Windows = {}
Library.MinimizedWindows = {}
Library.Themes = {}
Library.CurrentTheme = nil
Library.Notifications = {}

-- =================== TEMAS ===================
Library.Themes.Dark = {
    Name="Dark", Primary=Color3.fromRGB(0,120,215), Secondary=Color3.fromRGB(30,30,30),
    Background=Color3.fromRGB(20,20,20), Text=Color3.fromRGB(255,255,255),
    TextSecondary=Color3.fromRGB(200,200,200), Accent=Color3.fromRGB(0,150,255),
    Glow=Color3.fromRGB(0,120,215), Shadow=Color3.fromRGB(0,0,0),
    Element=Color3.fromRGB(35,35,35), Success=Color3.fromRGB(0,200,83),
    Warning=Color3.fromRGB(255,193,7), Error=Color3.fromRGB(255,87,87)
}
Library.Themes.RedNeon = {
    Name="RedNeon", Primary=Color3.fromRGB(255,0,85), Secondary=Color3.fromRGB(40,40,40),
    Background=Color3.fromRGB(25,25,25), Text=Color3.fromRGB(255,255,255),
    TextSecondary=Color3.fromRGB(220,220,220), Accent=Color3.fromRGB(255,20,20),
    Glow=Color3.fromRGB(255,0,85), Shadow=Color3.fromRGB(20,0,5),
    Element=Color3.fromRGB(50,40,40), Success=Color3.fromRGB(255,64,129),
    Warning=Color3.fromRGB(255,193,7), Error=Color3.fromRGB(255,23,68)
}
Library.CurrentTheme = Library.Themes.Dark

-- =================== UTILITÁRIOS ===================
local function Tween(obj, props, time, style, dir)
    local t = TweenInfo.new(time or 0.25, style or Enum.EasingStyle.Quad, dir or Enum.EasingDirection.Out)
    local tween = TweenService:Create(obj, t, props)
    tween:Play()
    return tween
end

local function CreateRipple(button, color)
    local ripple = Instance.new("Frame")
    ripple.Size = UDim2.new(0,0,0,0)
    ripple.Position = UDim2.new(0.5,0,0.5,0)
    ripple.AnchorPoint = Vector2.new(0.5,0.5)
    ripple.BackgroundColor3 = color or Color3.new(1,1,1)
    ripple.BackgroundTransparency = 0.8
    ripple.ZIndex = 10
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(1,0)
    corner.Parent = ripple
    ripple.Parent = button
    Tween(ripple, {Size=UDim2.new(2,0,2,0), BackgroundTransparency=1}, 0.6)
    game:GetService("Debris"):AddItem(ripple,0.6)
end

local function AddShadow(frame, color, size)
    local shadow = Instance.new("ImageLabel")
    shadow.Name = "Shadow"
    shadow.Size = UDim2.new(1,size or 24,1,size or 24)
    shadow.Position = UDim2.new(0,-(size or 24)/2,0,-(size or 24)/2)
    shadow.BackgroundTransparency = 1
    shadow.Image = "rbxassetid://5554236805"
    shadow.ImageColor3 = color or Color3.new(0,0,0)
    shadow.ImageTransparency = 0.8
    shadow.ScaleType = Enum.ScaleType.Slice
    shadow.SliceCenter = Rect.new(10,10,118,118)
    shadow.ZIndex = -1
    shadow.Parent = frame
end

-- =================== WINDOW CLASS ===================
local Window = {}
Window.__index = Window

function Window.new(title, size)
    local self = setmetatable({}, Window)
    self.Title = title or "AxiomXLib"
    self.Size = size or UDim2.new(0,550,0,400)
    self.Tabs = {}
    self.Minimized = false
    self:CreateUI()
    self:SetupDrag()
    table.insert(Library.Windows,self)
    return self
end

function Window:CreateUI()
    self.ScreenGui = Instance.new("ScreenGui")
    self.ScreenGui.Name = "AxiomX_"..HttpService:GenerateGUID(false)
    self.ScreenGui.ResetOnSpawn = false
    self.ScreenGui.IgnoreGuiInset = true

    self.MainFrame = Instance.new("Frame")
    self.MainFrame.Size = self.Size
    self.MainFrame.Position = UDim2.new(0.5,0,0.5,0)
    self.MainFrame.AnchorPoint = Vector2.new(0.5,0.5)
    self.MainFrame.BackgroundColor3 = Library.CurrentTheme.Background
    local corner = Instance.new("UICorner"); corner.CornerRadius = UDim.new(0,8); corner.Parent=self.MainFrame
    AddShadow(self.MainFrame, Library.CurrentTheme.Shadow, 20)

    -- TopBar
    self.TitleBar = Instance.new("Frame")
    self.TitleBar.Size = UDim2.new(1,0,0,45)
    self.TitleBar.BackgroundColor3 = Library.CurrentTheme.Secondary
    local titleCorner = Instance.new("UICorner"); titleCorner.CornerRadius=UDim.new(0,8); titleCorner.Parent=self.TitleBar

    self.TitleLabel = Instance.new("TextLabel")
    self.TitleLabel.Size = UDim2.new(0.7,0,1,0)
    self.TitleLabel.Position = UDim2.new(0,15,0,0)
    self.TitleLabel.BackgroundTransparency = 1
    self.TitleLabel.Text = self.Title
    self.TitleLabel.TextColor3 = Library.CurrentTheme.Text
    self.TitleLabel.TextSize = 18
    self.TitleLabel.Font = Enum.Font.GothamSemibold
    self.TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    self.TitleLabel.Parent = self.TitleBar

    -- Botões
    local btnContainer = Instance.new("Frame")
    btnContainer.Size = UDim2.new(0.3,0,1,0)
    btnContainer.Position = UDim2.new(0.7,0,0,0)
    btnContainer.BackgroundTransparency = 1
    local list = Instance.new("UIListLayout")
    list.FillDirection = Enum.FillDirection.Horizontal
    list.HorizontalAlignment = Enum.HorizontalAlignment.Right
    list.Padding = UDim.new(0,5)
    list.Parent = btnContainer

    self.MinimizeButton = Instance.new("TextButton")
    self.MinimizeButton.Size = UDim2.new(0,35,0,35)
    self.MinimizeButton.BackgroundColor3 = Library.CurrentTheme.Primary
    self.MinimizeButton.BackgroundTransparency = 0.8
    self.MinimizeButton.Text = "−"
    self.MinimizeButton.TextColor3 = Library.CurrentTheme.Text
    self.MinimizeButton.TextSize = 20
    self.MinimizeButton.Font = Enum.Font.GothamBold
    self.MinimizeButton.AutoButtonColor = false
    local minCorner = Instance.new("UICorner"); minCorner.CornerRadius=UDim.new(0,6); minCorner.Parent=self.MinimizeButton
    self.MinimizeButton.MouseButton1Click:Connect(function()
        CreateRipple(self.MinimizeButton,Library.CurrentTheme.Accent)
        self:ToggleMinimize()
    end)

    self.CloseButton = Instance.new("TextButton")
    self.CloseButton.Size = UDim2.new(0,35,0,35)
    self.CloseButton.BackgroundColor3 = Library.CurrentTheme.Error
    self.CloseButton.BackgroundTransparency = 0.8
    self.CloseButton.Text = "✕"
    self.CloseButton.TextColor3 = Library.CurrentTheme.Text
    self.CloseButton.TextSize = 18
    self.CloseButton.Font = Enum.Font.GothamBold
    self.CloseButton.AutoButtonColor = false
    local closeCorner = Instance.new("UICorner"); closeCorner.CornerRadius=UDim.new(0,6); closeCorner.Parent=self.CloseButton
    self.CloseButton.MouseButton1Click:Connect(function()
        CreateRipple(self.CloseButton,Color3.new(1,0.5,0.5))
        self:Destroy()
    end)

    self.MinimizeButton.Parent = btnContainer
    self.CloseButton.Parent = btnContainer
    btnContainer.Parent = self.TitleBar
    self.TitleBar.Parent = self.MainFrame

    -- Containers
    self.TabContainer = Instance.new("Frame")
    self.TabContainer.Size = UDim2.new(0,180,1, -55)
    self.TabContainer.Position = UDim2.new(0,10,0,50)
    self.TabContainer.BackgroundTransparency = 1
    local tabList = Instance.new("UIListLayout")
    tabList.Padding = UDim.new(0,5)
    tabList.SortOrder = Enum.SortOrder.LayoutOrder
    tabList.Parent = self.TabContainer
    self.TabContainer.Parent = self.MainFrame

    self.ContentContainer = Instance.new("ScrollingFrame")
    self.ContentContainer.Size = UDim2.new(1,-200,1,-60)
    self.ContentContainer.Position = UDim2.new(0,190,0,50)
    self.ContentContainer.BackgroundTransparency = 1
    self.ContentContainer.BorderSizePixel = 0
    self.ContentContainer.ScrollBarThickness = 3
    self.ContentContainer.ScrollBarImageColor3 = Library.CurrentTheme.Primary
    self.ContentContainer.AutomaticCanvasSize = Enum.AutomaticSize.Y
    local contentLayout = Instance.new("UIListLayout")
    contentLayout.Padding = UDim.new(0,10)
    contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
    contentLayout.Parent = self.ContentContainer
    self.ContentContainer.Parent = self.MainFrame

    self.MainFrame.Parent = Players.LocalPlayer:WaitForChild("PlayerGui") or CoreGui
    self.MainFrame.Size = UDim2.new(0,0,0,0)
    self.MainFrame.BackgroundTransparency = 1
    Tween(self.MainFrame,{Size=self.Size,BackgroundTransparency=0.05},0.4,Enum.EasingStyle.Back,Enum.EasingDirection.Out)
end

function Window:SetupDrag()
    local dragging=false
    local dragStart, startPos
    self.TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging=true
            dragStart=input.Position
            startPos=self.MainFrame.Position
        end
    end)
    self.TitleBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging=false end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType==Enum.UserInputType.MouseMovement then
            local delta=input.Position-dragStart
            self.MainFrame.Position=UDim2.new(startPos.X.Scale,startPos.X.Offset+delta.X,startPos.Y.Scale,startPos.Y.Offset+delta.Y)
        end
    end)
end

function Window:ToggleMinimize()
    self.Minimized = not self.Minimized
    if self.Minimized then
        self.TabContainer.Visible=false
        self.ContentContainer.Visible=false
        Tween(self.MainFrame,{Size=UDim2.new(0,300,0,45)},0.3)
        self.MinimizeButton.Text="+"
        table.insert(Library.MinimizedWindows,self)
    else
        self.TabContainer.Visible=true
        self.ContentContainer.Visible=true
        Tween(self.MainFrame,{Size=self.Size},0.3)
        self.MinimizeButton.Text="−"
        for i,win in ipairs(Library.MinimizedWindows) do
            if win==self then table.remove(Library.MinimizedWindows,i); break end
        end
    end
end

-- =================== LIBRARY FUNCTIONS ===================
function Library:CreateWindow(title, size)
    return Window.new(title, size)
end

function Library:Notify(title, text, duration)
    duration = duration or 3
    local notif = Instance.new("Frame")
    notif.Size = UDim2.new(0,250,0,60)
    notif.Position = UDim2.new(0.5,0,0.1,0)
    notif.AnchorPoint = Vector2.new(0.5,0)
    notif.BackgroundColor3 = Library.CurrentTheme.Secondary
    local corner = Instance.new("UICorner"); corner.CornerRadius=UDim.new(0,6); corner.Parent=notif
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -10, 1, -10)
    label.Position = UDim2.new(0,5,0,5)
    label.BackgroundTransparency=1
    label.Text = title.."\n"..text
    label.TextColor3 = Library.CurrentTheme.Text
    label.TextWrapped=true
    label.TextXAlignment=Enum.TextXAlignment.Left
    label.TextYAlignment=Enum.TextYAlignment.Top
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.Parent=notif
    notif.Parent=Players.LocalPlayer:WaitForChild("PlayerGui") or CoreGui
    Tween(notif,{Position=UDim2.new(0.5,0,0.15,0)},0.3)
    task.delay(duration,function()
        Tween(notif,{Position=UDim2.new(0.5,0,0.05,0), BackgroundTransparency=1},0.3)
        task.wait(0.3)
        notif:Destroy()
    end)
end

return Library

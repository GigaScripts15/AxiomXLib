-- Nexus Library v6.2 â€“ Completa e Corrigida
-- By: VocÃª ðŸ”¥
-- Modo de usar: local Nexus = loadstring(game:HttpGet("raw_url"))()
-- Exemplo:
-- local win = Nexus:CreateWindow({Title = "Meu Script", Theme = "Purple"})
-- local tab = win:CreateTab("Principal", Nexus.Assets.Features)
-- tab:CreateButton("Clique", function() Nexus:Notify({Title="Oi", Content="Teste"}) end)

local Nexus = {}

-- ServiÃ§os
local Players = game:GetService("Players")
local Tween = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local Run = game:GetService("RunService")
local Virtual = game:GetService("VirtualUser")
local StarterGui = game:GetService("StarterGui")
local Http = game:GetService("HttpService")
local Teleport = game:GetService("TeleportService")
local Sound = game:GetService("SoundService")
local CoreGui = game:GetService("CoreGui")
local GuiService = game:GetService("GuiService")

local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()
local Camera = Workspace.CurrentCamera

-- FunÃ§Ã£o segura para obter o pai da GUI (fallback para CoreGui)
local function GetSafeParent()
	local success, gui = pcall(function() return Player:WaitForChild("PlayerGui") end)
	if success and gui then return gui end
	return CoreGui
end

-- ==================================================
-- CONFIGURAÃ‡Ã•ES PERSISTENTES
-- ==================================================
Nexus.Settings = {
	Theme = "Purple",
	FPSMonitor = false,
	BorderAnimation = true,
	Notifications = true,
	Tooltips = true,
	SoundEffects = false,
	NotificationPosition = "TopRight",
	Keybinds = {
		ToggleUI = Enum.KeyCode.RightShift,
		ToggleESP = Enum.KeyCode.E,
		ToggleFly = Enum.KeyCode.F,
		TeleportToMouse = Enum.KeyCode.T,
	},
	ESP = { Enabled = false, Box = true, Name = true, Color = Color3.fromRGB(255,255,255) },
	Aimbot = { Enabled = false, Smoothness = 0.5, FOV = 100, TargetPart = "Head", TeamCheck = false },
	Character = { WalkSpeed = 16, JumpPower = 50, Gravity = 196.2, InfiniteJump = false, NoClip = false, Fly = false, AntiAFK = false },
	World = { Brightness = 1, GlobalShadows = true, FogEnd = 100000 },
	Optimization = { FPSBoost = false, RemoveParticles = false, RemoveWater = false },
}

local function LoadSettings()
	local success, data = pcall(function()
		local store = Player:FindFirstChild("Nexus_Settings")
		if store and store:IsA("StringValue") then
			return Http:JSONDecode(store.Value)
		end
	end)
	if success and data then
		for k, v in pairs(data) do
			if type(Nexus.Settings[k]) == "table" and type(v) == "table" then
				for k2, v2 in pairs(v) do
					Nexus.Settings[k][k2] = v2
				end
			else
				Nexus.Settings[k] = v
			end
		end
	end
end

local function SaveSettings()
	pcall(function()
		local data = Http:JSONEncode(Nexus.Settings)
		local store = Player:FindFirstChild("Nexus_Settings")
		if not store then
			store = Instance.new("StringValue")
			store.Name = "Nexus_Settings"
			store.Parent = Player
		end
		store.Value = data
	end)
end

LoadSettings()

-- ==================================================
-- TEMAS (10 temas)
-- ==================================================
Nexus.Themes = {
	Purple = { Name = "Purple", BgColor = Color3.fromRGB(18,0,30), Primary = Color3.fromRGB(170,0,255), Secondary = Color3.fromRGB(200,0,255), Button = Color3.fromRGB(30,0,50), ButtonHover = Color3.fromRGB(60,0,90), Text = Color3.new(1,1,1), ToastColor = Color3.fromRGB(30,0,50), Success = Color3.fromRGB(0,255,0), Error = Color3.fromRGB(255,0,0), Warning = Color3.fromRGB(255,255,0) },
	Dark = { Name = "Dark", BgColor = Color3.fromRGB(8,8,12), Primary = Color3.fromRGB(0,200,255), Secondary = Color3.fromRGB(0,255,200), Button = Color3.fromRGB(20,20,30), ButtonHover = Color3.fromRGB(40,40,60), Text = Color3.new(1,1,1), ToastColor = Color3.fromRGB(20,20,30), Success = Color3.fromRGB(0,255,0), Error = Color3.fromRGB(255,0,0), Warning = Color3.fromRGB(255,255,0) },
	Blood = { Name = "Blood", BgColor = Color3.fromRGB(25,0,0), Primary = Color3.fromRGB(200,0,0), Secondary = Color3.fromRGB(255,80,80), Button = Color3.fromRGB(50,0,0), ButtonHover = Color3.fromRGB(80,0,0), Text = Color3.new(1,1,1), ToastColor = Color3.fromRGB(40,0,0), Success = Color3.fromRGB(0,255,0), Error = Color3.fromRGB(255,0,0), Warning = Color3.fromRGB(255,255,0) },
	Gold = { Name = "Gold", BgColor = Color3.fromRGB(20,15,5), Primary = Color3.fromRGB(255,200,0), Secondary = Color3.fromRGB(255,230,100), Button = Color3.fromRGB(50,40,10), ButtonHover = Color3.fromRGB(80,65,20), Text = Color3.new(1,1,1), ToastColor = Color3.fromRGB(40,30,5), Success = Color3.fromRGB(0,255,0), Error = Color3.fromRGB(255,0,0), Warning = Color3.fromRGB(255,255,0) },
	Candy = { Name = "Candy", BgColor = Color3.fromRGB(40,10,30), Primary = Color3.fromRGB(255,120,200), Secondary = Color3.fromRGB(255,200,220), Button = Color3.fromRGB(80,20,50), ButtonHover = Color3.fromRGB(110,40,70), Text = Color3.new(1,1,1), ToastColor = Color3.fromRGB(60,20,40), Success = Color3.fromRGB(0,255,0), Error = Color3.fromRGB(255,0,0), Warning = Color3.fromRGB(255,255,0) },
	Ocean = { Name = "Ocean", BgColor = Color3.fromRGB(0,20,40), Primary = Color3.fromRGB(0,150,255), Secondary = Color3.fromRGB(100,200,255), Button = Color3.fromRGB(0,40,60), ButtonHover = Color3.fromRGB(0,70,100), Text = Color3.new(1,1,1), ToastColor = Color3.fromRGB(0,30,50), Success = Color3.fromRGB(0,255,0), Error = Color3.fromRGB(255,0,0), Warning = Color3.fromRGB(255,255,0) },
	Forest = { Name = "Forest", BgColor = Color3.fromRGB(10,30,10), Primary = Color3.fromRGB(0,180,0), Secondary = Color3.fromRGB(100,255,100), Button = Color3.fromRGB(20,50,20), ButtonHover = Color3.fromRGB(40,80,40), Text = Color3.new(1,1,1), ToastColor = Color3.fromRGB(20,40,20), Success = Color3.fromRGB(0,255,0), Error = Color3.fromRGB(255,0,0), Warning = Color3.fromRGB(255,255,0) },
	Cyber = { Name = "Cyber", BgColor = Color3.fromRGB(0,0,20), Primary = Color3.fromRGB(255,0,255), Secondary = Color3.fromRGB(0,255,255), Button = Color3.fromRGB(30,0,40), ButtonHover = Color3.fromRGB(60,0,80), Text = Color3.new(1,1,1), ToastColor = Color3.fromRGB(20,0,30), Success = Color3.fromRGB(0,255,0), Error = Color3.fromRGB(255,0,0), Warning = Color3.fromRGB(255,255,0) },
	Ice = { Name = "Ice", BgColor = Color3.fromRGB(20,40,60), Primary = Color3.fromRGB(100,200,255), Secondary = Color3.fromRGB(200,255,255), Button = Color3.fromRGB(30,60,80), ButtonHover = Color3.fromRGB(50,90,120), Text = Color3.new(1,1,1), ToastColor = Color3.fromRGB(30,50,70), Success = Color3.fromRGB(0,255,0), Error = Color3.fromRGB(255,0,0), Warning = Color3.fromRGB(255,255,0) },
	Lava = { Name = "Lava", BgColor = Color3.fromRGB(40,10,0), Primary = Color3.fromRGB(255,100,0), Secondary = Color3.fromRGB(255,200,100), Button = Color3.fromRGB(80,20,0), ButtonHover = Color3.fromRGB(120,40,0), Text = Color3.new(1,1,1), ToastColor = Color3.fromRGB(60,15,0), Success = Color3.fromRGB(0,255,0), Error = Color3.fromRGB(255,0,0), Warning = Color3.fromRGB(255,255,0) },
}

Nexus.CurrentTheme = Nexus.Themes[Nexus.Settings.Theme] or Nexus.Themes.Purple

-- ==================================================
-- GERENCIADOR DE CONEXÃ•ES (ANTI-LEAK)
-- ==================================================
local Connections = {}
local function AddConnection(conn, tag)
	if conn then
		table.insert(Connections, { conn, tag })
	end
end

local function DisconnectByTag(tag)
	for i = #Connections, 1, -1 do
		local item = Connections[i]
		if item and item[2] == tag then
			pcall(item[1].Disconnect, item[1])
			table.remove(Connections, i)
		end
	end
end

local function DisconnectAll()
	for _, item in ipairs(Connections) do
		pcall(item[1].Disconnect, item[1])
	end
	Connections = {}
end

-- ==================================================
-- NOTIFICAÃ‡Ã•ES (4 posiÃ§Ãµes, animadas) â€“ sem assets externos
-- ==================================================
function Nexus:Notify(notification)
	if not self.Settings.Notifications then return end
	notification = notification or {}
	local title = notification.Title or "Nexus"
	local content = notification.Content or ""
	local duration = notification.Duration or 5
	local position = notification.Position or self.Settings.NotificationPosition

	local parent = GetSafeParent()
	local frame = Instance.new("Frame")
	frame.Parent = parent
	frame.Size = UDim2.new(0, 300, 0, 80)
	frame.BackgroundColor3 = self.CurrentTheme.ToastColor
	frame.BackgroundTransparency = 0.2
	frame.BorderSizePixel = 0
	frame.ClipsDescendants = true
	Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)
	Instance.new("UIStroke", frame).Color = self.CurrentTheme.Primary

	local startPos, endPos
	if position == "TopLeft" then
		frame.Position = UDim2.new(0, -320, 0, 20)
		endPos = UDim2.new(0, 20, 0, 20)
	elseif position == "TopRight" then
		frame.Position = UDim2.new(1, -20, 0, -100)
		endPos = UDim2.new(1, -320, 0, 20)
	elseif position == "BottomLeft" then
		frame.Position = UDim2.new(0, -320, 1, -100)
		endPos = UDim2.new(0, 20, 1, -100)
	elseif position == "BottomRight" then
		frame.Position = UDim2.new(1, -20, 1, -100)
		endPos = UDim2.new(1, -320, 1, -100)
	end

	-- Ãcone simples (um cÃ­rculo colorido, sem depender de asset externo)
	local icon = Instance.new("Frame")
	icon.Parent = frame
	icon.Size = UDim2.new(0, 40, 0, 40)
	icon.Position = UDim2.new(0, 10, 0.5, -20)
	icon.BackgroundColor3 = self.CurrentTheme.Primary
	icon.BorderSizePixel = 0
	Instance.new("UICorner", icon).CornerRadius = UDim.new(1,0)

	local titleLabel = Instance.new("TextLabel")
	titleLabel.Parent = frame
	titleLabel.Size = UDim2.new(1, -60, 0, 30)
	titleLabel.Position = UDim2.new(0, 60, 0, 10)
	titleLabel.BackgroundTransparency = 1
	titleLabel.Text = title
	titleLabel.Font = Enum.Font.GothamSemibold
	titleLabel.TextSize = 16
	titleLabel.TextColor3 = self.CurrentTheme.Secondary
	titleLabel.TextXAlignment = Enum.TextXAlignment.Left

	local contentLabel = Instance.new("TextLabel")
	contentLabel.Parent = frame
	contentLabel.Size = UDim2.new(1, -60, 0, 30)
	contentLabel.Position = UDim2.new(0, 60, 0, 40)
	contentLabel.BackgroundTransparency = 1
	contentLabel.Text = content
	contentLabel.Font = Enum.Font.Gotham
	contentLabel.TextSize = 14
	contentLabel.TextColor3 = self.CurrentTheme.Text
	contentLabel.TextXAlignment = Enum.TextXAlignment.Left
	contentLabel.TextWrapped = true

	frame:TweenPosition(endPos, Enum.EasingDirection.Out, Enum.EasingStyle.Back, 0.5, true)

	task.wait(duration)
	frame:TweenPosition(startPos, Enum.EasingDirection.In, Enum.EasingStyle.Back, 0.5, true)
	task.wait(0.5)
	frame:Destroy()
end

-- ==================================================
-- TOOLTIPS (com delay) â€“ sem assets externos
-- ==================================================
local TooltipActive = nil
local function AddTooltip(button, text)
	if not Nexus.Settings.Tooltips then return end
	local tipConn
	button.MouseEnter:Connect(function()
		tipConn = task.delay(0.3, function()
			if TooltipActive then TooltipActive:Destroy() end
			local parent = GetSafeParent()
			local tip = Instance.new("TextLabel")
			tip.Parent = parent
			tip.Size = UDim2.new(0, #text * 8 + 30, 0, 30)
			tip.Position = UDim2.new(0, button.AbsolutePosition.X + button.AbsoluteSize.X/2 - tip.Size.X.Offset/2, 0, button.AbsolutePosition.Y - 40)
			tip.BackgroundColor3 = Color3.fromRGB(20,20,30)
			tip.Text = text
			tip.Font = Enum.Font.Gotham
			tip.TextSize = 15
			tip.TextColor3 = Color3.new(1,1,1)
			Instance.new("UICorner", tip).CornerRadius = UDim.new(0,8)
			Instance.new("UIStroke", tip).Color = Nexus.CurrentTheme.Primary
			tip.Visible = false
			tip:TweenPosition(UDim2.new(0, button.AbsolutePosition.X + button.AbsoluteSize.X/2 - tip.Size.X.Offset/2, 0, button.AbsolutePosition.Y - 45), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
			tip.Visible = true
			TooltipActive = tip
		end)
	end)
	button.MouseLeave:Connect(function()
		if tipConn then task.cancel(tipConn) end
		if TooltipActive then
			TooltipActive:Destroy()
			TooltipActive = nil
		end
	end)
end

-- ==================================================
-- ASSETS (ÃCONES) â€“ usando assets seguros e existentes
-- ==================================================
local Asset = {
	Minimize = "rbxasset://textures/ui/Settings/MenuDownArrow.png",
	Minimize2 = "rbxasset://textures/ui/Settings/MenuUpArrow.png",
	Close = "rbxasset://textures/ui/Options/Close.png",
	Settings = "rbxasset://textures/ui/Settings/MenuBarSettings.png",
	Theme = "rbxasset://textures/ui/Settings/MenuBarThemes.png",
	Player = "rbxasset://textures/ui/Controls/ControlPlayer.png",
	Features = "rbxasset://textures/ui/Controls/ControlGroup.png",
	Console = "rbxasset://textures/ui/Controls/ControlConsole.png",
	Explorer = "rbxasset://textures/ui/Controls/ControlFolder.png",
	Credits = "rbxasset://textures/ui/Controls/ControlCredit.png",
	ESP = "rbxasset://textures/ui/Controls/ControlEye.png",
	Aimbot = "rbxasset://textures/ui/Controls/ControlTarget.png",
	World = "rbxasset://textures/ui/Controls/ControlWorld.png",
	Character = "rbxasset://textures/ui/Controls/ControlCharacter.png",
}

-- Exportar assets para o usuÃ¡rio
Nexus.Assets = Asset

-- ==================================================
-- CRIAÃ‡ÃƒO DA JANELA PRINCIPAL
-- ==================================================
function Nexus:CreateWindow(options)
	options = options or {}
	local title = options.Title or "Nexus Window"
	local theme = options.Theme or self.Settings.Theme
	local size = options.Size or UDim2.new(0, 750, 0, 550)
	local themeTable = self.Themes[theme] or self.Themes.Purple

	local parent = GetSafeParent()
	local screenGui = Instance.new("ScreenGui")
	screenGui.Name = "Nexus_Window"
	screenGui.Parent = parent
	screenGui.ResetOnSpawn = false
	screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	screenGui.DisplayOrder = 100

	local main = Instance.new("Frame")
	main.Parent = screenGui
	main.Size = UDim2.new(0, 0, 0, 0)
	main.Position = UDim2.new(0.5, 0, 0.5, 0)
	main.BackgroundColor3 = themeTable.BgColor
	main.BorderSizePixel = 0
	main.Active = true
	main.ClipsDescendants = true
	main.Name = "MainFrame"
	Instance.new("UICorner", main).CornerRadius = UDim.new(0, 24)
	Instance.new("UIStroke", main).Color = themeTable.Primary

	local titleBar = Instance.new("Frame")
	titleBar.Parent = main
	titleBar.Size = UDim2.new(1, 0, 0, 40)
	titleBar.BackgroundTransparency = 1
	titleBar.ZIndex = 10

	local titleLabel = Instance.new("TextLabel")
	titleLabel.Parent = titleBar
	titleLabel.Size = UDim2.new(1, -80, 1, 0)
	titleLabel.Position = UDim2.new(0, 10, 0, 0)
	titleLabel.BackgroundTransparency = 1
	titleLabel.Text = title
	titleLabel.Font = Enum.Font.GothamSemibold
	titleLabel.TextSize = 18
	titleLabel.TextColor3 = themeTable.Secondary
	titleLabel.TextXAlignment = Enum.TextXAlignment.Left

	local closeBtn = Instance.new("ImageButton")
	closeBtn.Parent = titleBar
	closeBtn.Size = UDim2.new(0, 30, 0, 30)
	closeBtn.Position = UDim2.new(1, -40, 0.5, -15)
	closeBtn.BackgroundTransparency = 1
	closeBtn.Image = Asset.Close
	closeBtn.ImageColor3 = Color3.fromRGB(255,100,100)
	AddTooltip(closeBtn, "Fechar")
	closeBtn.MouseButton1Click:Connect(function()
		DisconnectAll()
		SaveSettings()
		main:TweenSizeAndPosition(UDim2.new(0,0,0,0), UDim2.new(0.5,0,0.5,0), Enum.EasingDirection.In, Enum.EasingStyle.Back, 0.4, true)
		task.wait(0.4)
		screenGui:Destroy()
	end)

	local minBtn = Instance.new("ImageButton")
	minBtn.Parent = titleBar
	minBtn.Size = UDim2.new(0, 30, 0, 30)
	minBtn.Position = UDim2.new(1, -80, 0.5, -15)
	minBtn.BackgroundTransparency = 1
	minBtn.Image = Asset.Minimize
	minBtn.ImageColor3 = themeTable.Primary
	AddTooltip(minBtn, "Minimizar")
	local minimized = false
	minBtn.MouseButton1Click:Connect(function()
		minimized = not minimized
		if minimized then
			main:TweenSize(UDim2.new(0, 350, 0, 40), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.25, true)
			minBtn.Image = Asset.Minimize2
			AddTooltip(minBtn, "Restaurar")
		else
			main:TweenSize(size, Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.25, true)
			minBtn.Image = Asset.Minimize
			AddTooltip(minBtn, "Minimizar")
		end
	end)

	local tabsFrame = Instance.new("Frame")
	tabsFrame.Parent = main
	tabsFrame.Size = UDim2.new(0, 180, 1, -90)
	tabsFrame.Position = UDim2.new(0, 0, 0, 50)
	tabsFrame.BackgroundTransparency = 1

	local contentFrame = Instance.new("Frame")
	contentFrame.Parent = main
	contentFrame.Size = UDim2.new(1, -190, 1, -100)
	contentFrame.Position = UDim2.new(0, 185, 0, 55)
	contentFrame.BackgroundTransparency = 1
	contentFrame.ClipsDescendants = true

	local window = {}
	window.Main = main
	window.ScreenGui = screenGui
	window.Theme = themeTable
	window.Tabs = {}
	window.TabFrame = tabsFrame
	window.ContentFrame = contentFrame
	window.Notify = function(notif) Nexus:Notify(notif) end

	-- Arrastar a janela (mouse e toque)
	local dragging = false
	local dragStart, startPos
	titleBar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = main.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	titleBar.InputChanged:Connect(function(input)
		if (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) and dragging then
			local delta = input.Position - dragStart
			local newPos = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
			main.Position = newPos
		end
	end)

	-- AnimaÃ§Ã£o de entrada
	main:TweenSizeAndPosition(size, UDim2.new(0.5, -size.X.Offset/2, 0.5, -size.Y.Offset/2), Enum.EasingDirection.Out, Enum.EasingStyle.Back, 0.5, true)

	-- MÃ©todo para criar aba
	function window:CreateTab(name, icon)
		icon = icon or Asset.Features
		local tab = {}
		tab.Name = name
		tab.Window = self

		local tabButton = Instance.new("TextButton")
		tabButton.Parent = self.TabFrame
		tabButton.Size = UDim2.new(1, -10, 0, 40)
		tabButton.BackgroundColor3 = self.Theme.Button
		tabButton.Text = "  " .. name
		tabButton.Font = Enum.Font.Gotham
		tabButton.TextSize = 14
		tabButton.TextColor3 = self.Theme.Text
		tabButton.TextXAlignment = Enum.TextXAlignment.Left
		Instance.new("UICorner", tabButton).CornerRadius = UDim.new(0, 8)
		Instance.new("UIStroke", tabButton).Color = self.Theme.Primary

		local tabIcon = Instance.new("ImageLabel")
		tabIcon.Parent = tabButton
		tabIcon.Size = UDim2.new(0, 20, 0, 20)
		tabIcon.Position = UDim2.new(0, 5, 0.5, -10)
		tabIcon.BackgroundTransparency = 1
		tabIcon.Image = icon
		tabIcon.ImageColor3 = self.Theme.Text

		local tabPage = Instance.new("ScrollingFrame")
		tabPage.Parent = self.ContentFrame
		tabPage.Size = UDim2.new(1, 0, 1, 0)
		tabPage.BackgroundTransparency = 1
		tabPage.BorderSizePixel = 0
		tabPage.ScrollBarThickness = 5
		tabPage.ScrollBarImageColor3 = self.Theme.Primary
		tabPage.CanvasSize = UDim2.new(0, 0, 0, 0)
		tabPage.Visible = false

		local pageLayout = Instance.new("UIListLayout", tabPage)
		pageLayout.Padding = UDim.new(0, 8)
		pageLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		pageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
			tabPage.CanvasSize = UDim2.new(0, 0, 0, pageLayout.AbsoluteContentSize.Y + 20)
		end)

		tab.Page = tabPage
		tab.Button = tabButton
		tab.Icon = tabIcon

		local function activateTab()
			for _, other in ipairs(self.Tabs) do
				other.Page.Visible = false
				other.Button.BackgroundColor3 = self.Theme.Button
				other.Button.TextColor3 = self.Theme.Text
				other.Button.UIStroke.Color = self.Theme.Primary
				if other.Icon then other.Icon.ImageColor3 = self.Theme.Text end
			end
			tabPage.Visible = true
			tabButton.BackgroundColor3 = self.Theme.Secondary
			tabButton.TextColor3 = Color3.new(0,0,0)
			tabButton.UIStroke.Color = Color3.new(1,1,1)
			tabIcon.ImageColor3 = Color3.new(0,0,0)
		end

		tabButton.MouseButton1Click:Connect(activateTab)
		tab.Activate = activateTab

		table.insert(self.Tabs, tab)

		-- Se for a primeira aba, ativar automaticamente
		if #self.Tabs == 1 then
			task.defer(activateTab)
		end

		-- MÃ©todos da aba
		function tab:CreateSection(text)
			local container = Instance.new("Frame")
			container.Parent = self.Page
			container.Size = UDim2.new(1, -20, 0, 30)
			container.BackgroundTransparency = 1

			local line = Instance.new("Frame")
			line.Parent = container
			line.Size = UDim2.new(1, 0, 0, 2)
			line.Position = UDim2.new(0, 0, 1, -2)
			line.BackgroundColor3 = self.Window.Theme.Primary
			line.BackgroundTransparency = 0.5
			Instance.new("UICorner", line).CornerRadius = UDim.new(1,0)

			local sectionLabel = Instance.new("TextLabel")
			sectionLabel.Parent = container
			sectionLabel.Size = UDim2.new(1, -10, 1, 0)
			sectionLabel.BackgroundTransparency = 1
			sectionLabel.Text = "   " .. text
			sectionLabel.Font = Enum.Font.GothamBlack
			sectionLabel.TextSize = 16
			sectionLabel.TextColor3 = self.Window.Theme.Secondary
			sectionLabel.TextXAlignment = Enum.TextXAlignment.Left

			return container
		end

		function tab:CreateButton(text, callback, tooltip, icon)
			local btn = Instance.new("TextButton")
			btn.Parent = self.Page
			btn.Size = UDim2.new(1, -20, 0, 35)
			btn.BackgroundColor3 = self.Window.Theme.Button
			btn.Text = text
			btn.Font = Enum.Font.Gotham
			btn.TextSize = 14
			btn.TextColor3 = self.Window.Theme.Text
			Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
			local stroke = Instance.new("UIStroke", btn)
			stroke.Color = self.Window.Theme.Primary
			stroke.Thickness = 1.5
			if tooltip then AddTooltip(btn, tooltip) end
			if icon then
				local ic = Instance.new("ImageLabel")
				ic.Parent = btn
				ic.Size = UDim2.new(0, 20, 0, 20)
				ic.Position = UDim2.new(0, 8, 0.5, -10)
				ic.BackgroundTransparency = 1
				ic.Image = icon
				ic.ImageColor3 = self.Window.Theme.Text
			end
			btn.MouseEnter:Connect(function()
				Tween:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = self.Window.Theme.ButtonHover}):Play()
			end)
			btn.MouseLeave:Connect(function()
				Tween:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = self.Window.Theme.Button}):Play()
			end)
			btn.MouseButton1Click:Connect(function()
				local s, e = pcall(callback or function() end)
				if not s then Nexus:Notify({Title = "Erro", Content = tostring(e), Duration = 5}) end
			end)
			return btn
		end

		function tab:CreateToggle(options)
			local text = options.Text or "Toggle"
			local state = options.Default or false
			local callback = options.Callback or function() end

			local btn = Instance.new("TextButton")
			btn.Parent = self.Page
			btn.Size = UDim2.new(1, -20, 0, 35)
			btn.BackgroundColor3 = self.Window.Theme.Button
			btn.Text = text
			btn.Font = Enum.Font.Gotham
			btn.TextSize = 14
			btn.TextColor3 = self.Window.Theme.Text
			btn.TextXAlignment = Enum.TextXAlignment.Left
			btn.PaddingLeft = UDim.new(0, 10)
			Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
			Instance.new("UIStroke", btn).Color = self.Window.Theme.Primary
			if options.Tooltip then AddTooltip(btn, options.Tooltip) end

			local indicator = Instance.new("Frame")
			indicator.Parent = btn
			indicator.Size = UDim2.new(0, 36, 0, 20)
			indicator.Position = UDim2.new(1, -46, 0.5, -10)
			indicator.BackgroundColor3 = Color3.fromRGB(0.5,0.5,0.5)
			Instance.new("UICorner", indicator).CornerRadius = UDim.new(1,0)

			local knob = Instance.new("Frame")
			knob.Parent = indicator
			knob.Size = UDim2.new(0, 18, 0, 18)
			knob.Position = state and UDim2.new(1, -19, 0.5, -9) or UDim2.new(0, 1, 0.5, -9)
			knob.BackgroundColor3 = Color3.new(1,1,1)
			Instance.new("UICorner", knob).CornerRadius = UDim.new(1,0)

			local function updateVisual(newState)
				if newState then
					indicator.BackgroundColor3 = self.Window.Theme.Success
					knob:TweenPosition(UDim2.new(1, -19, 0.5, -9), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
				else
					indicator.BackgroundColor3 = Color3.fromRGB(0.5,0.5,0.5)
					knob:TweenPosition(UDim2.new(0, 1, 0.5, -9), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
				end
			end

			updateVisual(state)

			btn.MouseButton1Click:Connect(function()
				state = not state
				updateVisual(state)
				local s, e = pcall(callback, state)
				if not s then Nexus:Notify({Title = "Erro", Content = tostring(e), Duration = 5}) end
			end)
			return btn
		end

		function tab:CreateSlider(options)
			local text = options.Text or "Slider"
			local min = options.Min or 0
			local max = options.Max or 100
			local default = options.Default or 50
			local callback = options.Callback or function() end

			local container = Instance.new("Frame")
			container.Parent = self.Page
			container.Size = UDim2.new(1, -20, 0, 45)
			container.BackgroundTransparency = 1

			local label = Instance.new("TextLabel")
			label.Parent = container
			label.Size = UDim2.new(1, 0, 0, 20)
			label.BackgroundTransparency = 1
			label.Text = text .. ": " .. default
			label.Font = Enum.Font.Gotham
			label.TextSize = 14
			label.TextColor3 = self.Window.Theme.Text
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.PaddingLeft = UDim.new(0, 5)

			local sliderBg = Instance.new("Frame")
			sliderBg.Parent = container
			sliderBg.Size = UDim2.new(1, -10, 0, 10)
			sliderBg.Position = UDim2.new(0, 5, 0, 25)
			sliderBg.BackgroundColor3 = Color3.fromRGB(50,50,50)
			Instance.new("UICorner", sliderBg).CornerRadius = UDim.new(1,0)

			local fill = Instance.new("Frame")
			fill.Parent = sliderBg
			fill.Size = UDim2.new((default-min)/(max-min), 0, 1, 0)
			fill.BackgroundColor3 = self.Window.Theme.Primary
			Instance.new("UICorner", fill).CornerRadius = UDim.new(1,0)

			local drag = Instance.new("TextButton")
			drag.Parent = sliderBg
			drag.Size = UDim2.new(0, 20, 0, 20)
			drag.Position = UDim2.new(fill.Size.X.Scale, -10, 0.5, -10)
			drag.BackgroundColor3 = Color3.new(1,1,1)
			drag.Text = ""
			Instance.new("UICorner", drag).CornerRadius = UDim.new(1,0)
			Instance.new("UIStroke", drag).Color = self.Window.Theme.Primary
			if options.Tooltip then AddTooltip(drag, options.Tooltip) end

			local val = default
			local dragging = false
			drag.MouseButton1Down:Connect(function()
				dragging = true
				local move
				move = Mouse.Move:Connect(function()
					if not dragging then return end
					local rel = (Mouse.X - sliderBg.AbsolutePosition.X) / sliderBg.AbsoluteSize.X
					rel = math.clamp(rel, 0, 1)
					fill.Size = UDim2.new(rel, 0, 1, 0)
					drag.Position = UDim2.new(rel, -10, 0.5, -10)
					val = math.floor(min + (max-min) * rel)
					label.Text = text .. ": " .. val
				end)
				local release
				release = Mouse.Button1Up:Connect(function()
					dragging = false
					move:Disconnect()
					release:Disconnect()
					local s, e = pcall(callback, val)
					if not s then Nexus:Notify({Title = "Erro", Content = tostring(e), Duration = 5}) end
				end)
			end)

			-- Suporte a toque
			drag.TouchLongPress:Connect(function()
				dragging = true
				local move
				move = Run.Heartbeat:Connect(function()
					if not dragging then return end
					local touchPos = UIS:GetTouchPosition()
					if touchPos then
						local rel = (touchPos.X - sliderBg.AbsolutePosition.X) / sliderBg.AbsoluteSize.X
						rel = math.clamp(rel, 0, 1)
						fill.Size = UDim2.new(rel, 0, 1, 0)
						drag.Position = UDim2.new(rel, -10, 0.5, -10)
						val = math.floor(min + (max-min) * rel)
						label.Text = text .. ": " .. val
					end
				end)
				local release
				release = UIS.TouchEnded:Connect(function()
					dragging = false
					move:Disconnect()
					release:Disconnect()
					local s, e = pcall(callback, val)
					if not s then Nexus:Notify({Title = "Erro", Content = tostring(e), Duration = 5}) end
				end)
			end)

			return container
		end

		function tab:CreateDropdown(options)
			local text = options.Text or "Dropdown"
			local values = options.Values or {}
			local default = options.Default or values[1]
			local callback = options.Callback or function() end

			local btn = self:CreateButton(text .. ": " .. tostring(default), function()
				local current = default
				local idx = 0
				for i, v in ipairs(values) do
					if v == current then idx = i end
				end
				local nextVal = values[(idx % #values) + 1]
				default = nextVal
				btn.Text = text .. ": " .. tostring(nextVal)
				callback(nextVal)
			end, options.Tooltip)
			return btn
		end

		function tab:CreateTextbox(options)
			local text = options.Text or "Texto"
			local default = options.Default or ""
			local callback = options.Callback or function() end

			local box = Instance.new("TextBox")
			box.Parent = self.Page
			box.Size = UDim2.new(1, -20, 0, 35)
			box.PlaceholderText = text
			box.Text = default
			box.Font = Enum.Font.Gotham
			box.TextSize = 14
			box.TextColor3 = self.Window.Theme.Text
			box.BackgroundColor3 = self.Window.Theme.Button
			box.BorderSizePixel = 0
			Instance.new("UICorner", box).CornerRadius = UDim.new(0, 8)
			local stroke = Instance.new("UIStroke", box)
			stroke.Color = self.Window.Theme.Primary
			stroke.Thickness = 1.5
			if options.Tooltip then AddTooltip(box, options.Tooltip) end

			box.Focused:Connect(function()
				stroke.Color = self.Window.Theme.Secondary
				stroke.Thickness = 2
			end)
			box.FocusLost:Connect(function(enter)
				stroke.Color = self.Window.Theme.Primary
				stroke.Thickness = 1.5
				if enter then
					local s, e = pcall(callback, box.Text)
					if not s then Nexus:Notify({Title = "Erro", Content = tostring(e), Duration = 5}) end
				end
			end)
			return box
		end

		function tab:CreateLabel(text)
			local label = Instance.new("TextLabel")
			label.Parent = self.Page
			label.Size = UDim2.new(1, -20, 0, 20)
			label.BackgroundTransparency = 1
			label.Text = text
			label.Font = Enum.Font.Gotham
			label.TextSize = 14
			label.TextColor3 = self.Window.Theme.Text
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.PaddingLeft = UDim.new(0, 10)
			return label
		end

		function tab:CreateParagraph(text)
			local para = Instance.new("TextLabel")
			para.Parent = self.Page
			para.Size = UDim2.new(1, -20, 0, 50)
			para.BackgroundTransparency = 1
			para.Text = text
			para.Font = Enum.Font.Gotham
			para.TextSize = 14
			para.TextColor3 = self.Window.Theme.Text
			para.TextWrapped = true
			para.TextYAlignment = Enum.TextYAlignment.Top
			para.RichText = true
			para.PaddingLeft = UDim.new(0, 10)
			para.PaddingRight = UDim.new(0, 10)
			return para
		end

		return tab
	end

	return window
end

-- ==================================================
-- MÃ“DULOS DE FUNCIONALIDADE
-- ==================================================

-- MÃ³dulo Fly
function Nexus:CreateFly()
	local flying = false
	local bodyVelocity = nil
	local connection = nil
	local function start()
		if flying then return end
		local char = Player.Character
		if not char then return end
		local root = char:FindFirstChild("HumanoidRootPart")
		local humanoid = char:FindFirstChild("Humanoid")
		if not root or not humanoid then return end
		flying = true
		humanoid.PlatformStand = true
		bodyVelocity = Instance.new("BodyVelocity")
		bodyVelocity.MaxForce = Vector3.new(1,1,1)*math.huge
		bodyVelocity.Velocity = Vector3.new(0,0,0)
		bodyVelocity.Parent = root
		connection = Run.Heartbeat:Connect(function()
			if not flying or not root.Parent then return end
			local move = Vector3.new()
			if UIS:IsKeyDown(Enum.KeyCode.W) then move = move + Camera.CFrame.LookVector end
			if UIS:IsKeyDown(Enum.KeyCode.S) then move = move - Camera.CFrame.LookVector end
			if UIS:IsKeyDown(Enum.KeyCode.A) then move = move - Camera.CFrame.RightVector end
			if UIS:IsKeyDown(Enum.KeyCode.D) then move = move + Camera.CFrame.RightVector end
			if UIS:IsKeyDown(Enum.KeyCode.Space) then move = move + Vector3.new(0,1,0) end
			if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then move = move - Vector3.new(0,1,0) end
			bodyVelocity.Velocity = move * 60
		end)
	end
	local function stop()
		flying = false
		if bodyVelocity then bodyVelocity:Destroy() bodyVelocity = nil end
		if connection then connection:Disconnect() connection = nil end
		local char = Player.Character
		if char then
			local humanoid = char:FindFirstChild("Humanoid")
			if humanoid then humanoid.PlatformStand = false end
		end
	end
	return {
		Toggle = function()
			if flying then stop() else start() end
			return flying
		end,
		Enable = start,
		Disable = stop,
		IsActive = function() return flying end
	}
end

-- MÃ³dulo ESP (simples com Highlight)
function Nexus:CreateESP()
	local espObjects = {}
	local function addESP(plr)
		if plr == Player then return end
		if plr.Character and not plr.Character:FindFirstChild("Nexus_ESP") then
			local highlight = Instance.new("Highlight")
			highlight.Name = "Nexus_ESP"
			highlight.FillColor = Nexus.CurrentTheme.Primary
			highlight.OutlineColor = Nexus.CurrentTheme.Secondary
			highlight.FillTransparency = 0.5
			highlight.Parent = plr.Character
			table.insert(espObjects, highlight)
		end
	end
	local function removeESP()
		for _, obj in ipairs(espObjects) do
			pcall(obj.Destroy, obj)
		end
		espObjects = {}
	end
	local function enable()
		removeESP()
		for _, plr in pairs(Players:GetPlayers()) do addESP(plr) end
	end
	local function disable()
		removeESP()
	end
	return {
		Enable = enable,
		Disable = disable,
		Toggle = function()
			if #espObjects > 0 then disable() else enable() end
			return #espObjects > 0
		end
	}
end

-- MÃ³dulo Aimbot simples
function Nexus:CreateAimbot()
	local active = false
	local connection = nil
	local function start()
		if active then return end
		active = true
		connection = Run.RenderStepped:Connect(function()
			if not active then return end
			local target = nil
			local shortest = Nexus.Settings.Aimbot.FOV
			local center = Camera.ViewportSize / 2
			for _, plr in pairs(Players:GetPlayers()) do
				if plr ~= Player and plr.Character and plr.Character:FindFirstChild(Nexus.Settings.Aimbot.TargetPart) then
					if Nexus.Settings.Aimbot.TeamCheck and plr.Team == Player.Team then continue end
					local part = plr.Character[Nexus.Settings.Aimbot.TargetPart]
					local pos, onScreen = Camera:WorldToViewportPoint(part.Position)
					if onScreen then
						local dist = (Vector2.new(pos.X, pos.Y) - center).Magnitude
						if dist < shortest then
							shortest = dist
							target = part
						end
					end
				end
			end
			if target then
				local look = CFrame.lookAt(Camera.CFrame.Position, target.Position)
				Camera.CFrame = Camera.CFrame:Lerp(look, Nexus.Settings.Aimbot.Smoothness, Enum.EasingStyle.Sine)
			end
		end)
	end
	local function stop()
		active = false
		if connection then connection:Disconnect() connection = nil end
	end
	return {
		Toggle = function()
			if active then stop() else start() end
			return active
		end,
		Enable = start,
		Disable = stop,
		IsActive = function() return active end
	}
end

-- MÃ³dulo NoClip
function Nexus:CreateNoClip()
	local active = false
	local connection = nil
	local function start()
		if active then return end
		active = true
		connection = Run.Stepped:Connect(function()
			if not active then return end
			local char = Player.Character
			if char then
				local root = char:FindFirstChild("HumanoidRootPart")
				if root then root.CanCollide = false end
			end
		end)
	end
	local function stop()
		active = false
		if connection then connection:Disconnect() connection = nil end
	end
	return {
		Toggle = function()
			if active then stop() else start() end
			return active
		end,
		Enable = start,
		Disable = stop,
		IsActive = function() return active end
	}
end

-- MÃ³dulo InfiniteJump
function Nexus:CreateInfiniteJump()
	local active = false
	local connection = nil
	local function start()
		if active then return end
		active = true
		connection = UIS.JumpRequest:Connect(function()
			if active then
				local char = Player.Character
				if char then
					local humanoid = char:FindFirstChild("Humanoid")
					if humanoid then
						humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
					end
				end
			end
		end)
	end
	local function stop()
		active = false
		if connection then connection:Disconnect() connection = nil end
	end
	return {
		Toggle = function()
			if active then stop() else start() end
			return active
		end,
		Enable = start,
		Disable = stop,
		IsActive = function() return active end
	}
end

-- MÃ³dulo Anti-AFK
function Nexus:CreateAntiAFK()
	local active = false
	local thread = nil
	local function start()
		if active then return end
		active = true
		thread = task.spawn(function()
			while active do
				task.wait(60)
				Virtual:CaptureController()
				Virtual:Button2Down(Vector2.new(0,0))
				task.wait(0.1)
				Virtual:Button2Up(Vector2.new(0,0))
			end
		end)
	end
	local function stop()
		active = false
		if thread then task.cancel(thread) thread = nil end
	end
	return {
		Toggle = function()
			if active then stop() else start() end
			return active
		end,
		Enable = start,
		Disable = stop,
		IsActive = function() return active end
	}
end

-- ==================================================
-- KEYBINDS GLOBAIS (com tratamento de nil)
-- ==================================================
UIS.InputBegan:Connect(function(input, gp)
	if gp then return end
	if input.UserInputType == Enum.UserInputType.Keyboard then
		if input.KeyCode == Nexus.Settings.Keybinds.ToggleUI then
			for _, v in pairs(GetSafeParent():GetChildren()) do
				if v.Name == "Nexus_Window" then
					v.Visible = not v.Visible
				end
			end
		elseif input.KeyCode == Nexus.Settings.Keybinds.ToggleESP then
			Nexus.Settings.ESP.Enabled = not Nexus.Settings.ESP.Enabled
			Nexus:Notify({Title = "ESP", Content = Nexus.Settings.ESP.Enabled and "Ativado" or "Desativado", Duration = 1.5})
		elseif input.KeyCode == Nexus.Settings.Keybinds.ToggleFly then
			Nexus.Settings.Character.Fly = not Nexus.Settings.Character.Fly
			Nexus:Notify({Title = "Fly", Content = Nexus.Settings.Character.Fly and "Ativado" or "Desativado", Duration = 1.5})
		elseif input.KeyCode == Nexus.Settings.Keybinds.TeleportToMouse then
			if Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
				Player.Character:MoveTo(Mouse.Hit.p)
			end
		end
	end
end)

-- ==================================================
-- FUNÃ‡ÃƒO PARA APLICAR TEMA EM UMA JANELA
-- ==================================================
function Nexus:ApplyTheme(window, themeName)
	local theme = self.Themes[themeName]
	if not theme then return end
	window.Theme = theme
	window.Main.BackgroundColor3 = theme.BgColor
	window.Main.UIStroke.Color = theme.Primary
	-- Atualizar tÃ­tulo (pode ter nome diferente, mas assumimos que existe um tÃ­tulo)
	local title = window.Main:FindFirstChildOfClass("TextLabel")
	if title then
		title.TextColor3 = theme.Secondary
		if title.TextStroke then title.TextStroke.Color = theme.Primary end
	end
	-- Atualizar botÃ£o minimizar
	local minBtn = window.Main:FindFirstChild("ImageButton")
	if minBtn then minBtn.ImageColor3 = theme.Primary end
	-- Atualizar abas
	for _, btn in pairs(window.TabFrame:GetChildren()) do
		if btn:IsA("TextButton") then
			btn.BackgroundColor3 = theme.Button
			btn.TextColor3 = theme.Text
			btn.UIStroke.Color = theme.Primary
			local ic = btn:FindFirstChildOfClass("ImageLabel")
			if ic then ic.ImageColor3 = theme.Text end
		end
	end
	window:Notify({Title = "Tema", Content = "Tema " .. themeName .. " aplicado!", Duration = 2})
end

return Nexus

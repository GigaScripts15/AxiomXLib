-- AxiomXLib.lua
-- Biblioteca de interface unificada com as melhores funcionalidades

local AxiomXLib = {}
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Temas
local themes = {
    Dark = {
        Main = Color3.fromRGB(30, 30, 30),
        Second = Color3.fromRGB(40, 40, 40),
        Background = Color3.fromRGB(25, 25, 25),
        Text = Color3.fromRGB(255, 255, 255),
        Accent = Color3.fromRGB(0, 160, 255),
        Danger = Color3.fromRGB(255, 70, 70),
        Success = Color3.fromRGB(70, 200, 70),
        Disabled = Color3.fromRGB(80, 80, 80),
        Hover = Color3.fromRGB(60, 60, 60)
    },
    Light = {
        Main = Color3.fromRGB(240, 240, 240),
        Second = Color3.fromRGB(220, 220, 220),
        Background = Color3.fromRGB(210, 210, 210),
        Text = Color3.fromRGB(20, 20, 20),
        Accent = Color3.fromRGB(0, 120, 255),
        Danger = Color3.fromRGB(200, 50, 50),
        Success = Color3.fromRGB(50, 150, 50),
        Disabled = Color3.fromRGB(150, 150, 150),
        Hover = Color3.fromRGB(180, 180, 180)
    }
}
local currentTheme = themes.Dark

-- Utilitários
local function new(class, props)
    local obj = Instance.new(class)
    for k, v in pairs(props) do
        obj[k] = v
    end
    return obj
end

local function safeCallback(callback, ...)
    if callback then
        local success, err = pcall(callback, ...)
        if not success then
            warn("AxiomXLib: Erro no callback:", err)
        end
    end
end

local function makeDraggable(dragHandle, target)
    local dragging, dragStart, startPos
    dragHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = target.Position
        end
    end)
    dragHandle.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            target.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
end

local function ripple(button)
    task.spawn(function()
        local circle = new("ImageLabel", {
            Parent = button,
            BackgroundTransparency = 1,
            Image = "rbxassetid://266543268",
            ImageColor3 = Color3.fromRGB(255, 255, 255),
            ImageTransparency = 0.7,
            ZIndex = 10
        })
        local x, y = Mouse.X - circle.AbsolutePosition.X, Mouse.Y - circle.AbsolutePosition.Y
        circle.Position = UDim2.new(0, x, 0, y)
        local size = math.max(button.AbsoluteSize.X, button.AbsoluteSize.Y) * 1.5
        circle:TweenSizeAndPosition(
            UDim2.new(0, size, 0, size),
            UDim2.new(0.5, -size/2, 0.5, -size/2),
            "Out", "Quad", 0.2, false
        )
        for _ = 1, 10 do
            circle.ImageTransparency += 0.1
            task.wait(0.02)
        end
        circle:Destroy()
    end)
end

-- Sistema de notificações
local function createNotificationSystem(parent)
    local holder = new("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -320, 0, 50),
        Size = UDim2.new(0, 300, 1, -100),
        ClipsDescendants = true
    })

    local function notify(config)
        config = config or {}
        local title = config.title or "Notificação"
        local message = config.message or ""
        local duration = config.duration or 3
        local callback = config.callback

        local notif = new("Frame", {
            Parent = holder,
            BackgroundColor3 = currentTheme.Second,
            BorderSizePixel = 0,
            Position = UDim2.new(0, 300, 0, 0),
            Size = UDim2.new(1, -10, 0, 80)
        })
        local notifCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = notif})

        -- Brilho
        local glow = new("ImageLabel", {
            Parent = notif,
            BackgroundTransparency = 1,
            Image = "rbxassetid://4996891970",
            ImageColor3 = Color3.fromRGB(15, 15, 15),
            ScaleType = Enum.ScaleType.Slice,
            SliceCenter = Rect.new(20, 20, 280, 280),
            Position = UDim2.new(0, -15, 0, -15),
            Size = UDim2.new(1, 30, 1, 30),
            ZIndex = 0
        })

        local titleLabel = new("TextLabel", {
            Parent = notif,
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamBold,
            Text = title,
            TextColor3 = currentTheme.Text,
            TextSize = 16,
            Position = UDim2.new(0, 10, 0, 5),
            Size = UDim2.new(1, -20, 0, 25),
            TextXAlignment = Enum.TextXAlignment.Left
        })

        local messageLabel = new("TextLabel", {
            Parent = notif,
            BackgroundTransparency = 1,
            Font = Enum.Font.Gotham,
            Text = message,
            TextColor3 = currentTheme.Text,
            TextSize = 14,
            Position = UDim2.new(0, 10, 0, 30),
            Size = UDim2.new(1, -20, 0, 40),
            TextWrapped = true,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextYAlignment = Enum.TextYAlignment.Top
        })

        local closeBtn = new("TextButton", {
            Parent = notif,
            BackgroundTransparency = 1,
            Text = "",
            Position = UDim2.new(1, -25, 0, 0),
            Size = UDim2.new(0, 25, 0, 25)
        })
        local closeIcon = new("ImageLabel", {
            Parent = closeBtn,
            BackgroundTransparency = 1,
            Image = "rbxassetid://6035047409",
            ImageColor3 = currentTheme.Text,
            Size = UDim2.new(0, 16, 0, 16),
            Position = UDim2.new(0.5, -8, 0.5, -8)
        })

        notif:TweenPosition(UDim2.new(0, 5, 0, 0), "Out", "Quad", 0.5, true)

        task.delay(duration, function()
            notif:TweenPosition(UDim2.new(0, 300, 0, 0), "Out", "Quad", 0.5, true)
            task.wait(0.5)
            notif:Destroy()
            safeCallback(callback)
        end)

        closeBtn.MouseButton1Click:Connect(function()
            notif:TweenPosition(UDim2.new(0, 300, 0, 0), "Out", "Quad", 0.5, true)
            task.wait(0.5)
            notif:Destroy()
        end)
    end

    return notify
end

-- Função principal: criar janela
function AxiomXLib:CreateWindow(config)
    config = config or {}
    local title = config.title or "AxiomX"
    local size = config.size or UDim2.new(0, 700, 0, 500)
    local theme = config.theme or "Dark"
    local closeBind = config.closeBind or Enum.KeyCode.RightControl
    currentTheme = themes[theme] or themes.Dark

    local gui = new("ScreenGui", {
        Name = "AxiomXLib",
        Parent = game:GetService("CoreGui"),
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    })

    local main = new("ImageButton", {  -- Usando ImageButton para o efeito de fundo com slice
        Name = "Main",
        Parent = gui,
        BackgroundColor3 = currentTheme.Main,
        BackgroundTransparency = 1,
        Image = "rbxassetid://2790389767",
        ImageColor3 = currentTheme.Main,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(8, 8, 248, 248),
        Position = UDim2.new(0.5, -size.X.Offset/2, 0.5, -size.Y.Offset/2),
        Size = size,
        ClipsDescendants = true
    })

    -- Brilho externo
    local glow = new("ImageLabel", {
        Parent = main,
        BackgroundTransparency = 1,
        Image = "rbxassetid://4996891970",
        ImageColor3 = Color3.fromRGB(15, 15, 15),
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(20, 20, 280, 280),
        Position = UDim2.new(0, -15, 0, -15),
        Size = UDim2.new(1, 30, 1, 30),
        ZIndex = 0
    })

    local top = new("Frame", {
        Parent = main,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -40, 0, 30),
        Position = UDim2.new(0.5, 0, 0, 10),
        AnchorPoint = Vector2.new(0.5, 0)
    })

    local titleLabel = new("TextLabel", {
        Parent = top,
        BackgroundTransparency = 1,
        Font = Enum.Font.GothamSemibold,
        Text = title,
        TextColor3 = currentTheme.Text,
        TextSize = 18,
        Size = UDim2.new(0, 200, 1, 0),
        TextXAlignment = Enum.TextXAlignment.Left
    })

    -- Botões de janela
    local closeBtn = new("TextButton", {
        Parent = top,
        BackgroundTransparency = 1,
        Text = "",
        Position = UDim2.new(1, -25, 0.5, -12),
        Size = UDim2.new(0, 24, 0, 24)
    })
    local closeIcon = new("ImageLabel", {
        Parent = closeBtn,
        BackgroundTransparency = 1,
        Image = "rbxassetid://6035047409",
        ImageColor3 = currentTheme.Text,
        Size = UDim2.new(0, 20, 0, 20),
        Position = UDim2.new(0.5, -10, 0.5, -10)
    })
    closeBtn.MouseEnter:Connect(function() closeIcon.ImageColor3 = currentTheme.Danger end)
    closeBtn.MouseLeave:Connect(function() closeIcon.ImageColor3 = currentTheme.Text end)
    closeBtn.MouseButton1Click:Connect(function()
        main:TweenSize(UDim2.new(0,0,0,0), "Out", "Quad", 0.3, true, function() gui:Destroy() end)
    end)

    local minimizeBtn = new("TextButton", {
        Parent = top,
        BackgroundTransparency = 1,
        Text = "",
        Position = UDim2.new(1, -55, 0.5, -12),
        Size = UDim2.new(0, 24, 0, 24)
    })
    local minimizeIcon = new("ImageLabel", {
        Parent = minimizeBtn,
        BackgroundTransparency = 1,
        Image = "rbxassetid://6035067836",
        ImageColor3 = currentTheme.Text,
        Size = UDim2.new(0, 20, 0, 20),
        Position = UDim2.new(0.5, -10, 0.5, -10)
    })
    local minimized = false
    minimizeBtn.MouseButton1Click:Connect(function()
        minimized = not minimized
        local newSize = minimized and UDim2.new(size.X.Scale, size.X.Offset, 0, 30) or size
        main:TweenSize(newSize, "Out", "Quad", 0.25)
    end)

    makeDraggable(top, main)

    -- Container principal (abaixo do topo)
    local container = new("Frame", {
        Parent = main,
        BackgroundColor3 = currentTheme.Background,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 10, 0, 45),
        Size = UDim2.new(1, -20, 1, -55)
    })
    local containerCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = container})

    -- Abas (lado esquerdo)
    local tabHolder = new("Frame", {
        Parent = container,
        BackgroundColor3 = currentTheme.Second,
        BorderSizePixel = 0,
        Size = UDim2.new(0, 150, 1, 0)
    })
    local tabCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = tabHolder})
    local tabList = new("UIListLayout", {
        Parent = tabHolder,
        FillDirection = Enum.FillDirection.Vertical,
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 5)
    })
    local tabPadding = new("UIPadding", {Parent = tabHolder, PaddingTop = UDim.new(0, 10)})

    -- Páginas (lado direito)
    local pageHolder = new("Frame", {
        Parent = container,
        BackgroundColor3 = currentTheme.Background,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 150, 0, 0),
        Size = UDim2.new(1, -150, 1, 0)
    })
    local pageCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = pageHolder})

    local pages = {}
    local currentPage

    -- Sistema de notificações da janela
    local notify = createNotificationSystem(gui)

    -- Tabs
    local tabs = {}

    function tabs:AddTab(name)
        local tabBtn = new("TextButton", {
            Parent = tabHolder,
            BackgroundColor3 = currentTheme.Second,
            AutoButtonColor = false,
            Font = Enum.Font.Gotham,
            Text = name,
            TextColor3 = currentTheme.Text,
            TextSize = 14,
            Size = UDim2.new(0, 130, 0, 30)
        })
        local btnCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = tabBtn})

        local page = new("ScrollingFrame", {
            Parent = pageHolder,
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            Size = UDim2.new(1, 0, 1, 0),
            CanvasSize = UDim2.new(0, 0, 0, 0),
            ScrollBarThickness = 4,
            ScrollBarImageColor3 = currentTheme.Second,
            Visible = false
        })
        local pageLayout = new("UIListLayout", {
            Parent = page,
            FillDirection = Enum.FillDirection.Vertical,
            HorizontalAlignment = Enum.HorizontalAlignment.Center,
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 8)
        })
        local pagePadding = new("UIPadding", {Parent = page, PaddingTop = UDim.new(0, 10), PaddingBottom = UDim.new(0, 10)})

        local function updateCanvas()
            page.CanvasSize = UDim2.new(0, 0, 0, pageLayout.AbsoluteContentSize.Y + 20)
        end
        pageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateCanvas)

        if not currentPage then
            currentPage = page
            page.Visible = true
            tabBtn.BackgroundColor3 = currentTheme.Accent
        end

        tabBtn.MouseButton1Click:Connect(function()
            if currentPage then currentPage.Visible = false end
            for _, btn in ipairs(tabHolder:GetChildren()) do
                if btn:IsA("TextButton") then
                    btn.BackgroundColor3 = currentTheme.Second
                end
            end
            tabBtn.BackgroundColor3 = currentTheme.Accent
            page.Visible = true
            currentPage = page
        end)

        -- Elementos da página
        local pageElements = {}

        function pageElements:AddButton(text, callback)
            local btn = new("TextButton", {
                Parent = page,
                BackgroundColor3 = currentTheme.Second,
                AutoButtonColor = false,
                Font = Enum.Font.Gotham,
                Text = text,
                TextColor3 = currentTheme.Text,
                TextSize = 14,
                Size = UDim2.new(0, page.AbsoluteSize.X - 20, 0, 35)
            })
            local btnCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = btn})

            btn.MouseEnter:Connect(function()
                TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = currentTheme.Hover}):Play()
            end)
            btn.MouseLeave:Connect(function()
                TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = currentTheme.Second}):Play()
            end)
            btn.MouseButton1Click:Connect(function()
                ripple(btn)
                safeCallback(callback)
            end)

            updateCanvas()
        end

        function pageElements:AddToggle(text, default, callback)
            local toggled = default or false
            local frame = new("Frame", {
                Parent = page,
                BackgroundColor3 = currentTheme.Second,
                BorderSizePixel = 0,
                Size = UDim2.new(0, page.AbsoluteSize.X - 20, 0, 35)
            })
            local frameCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = frame})

            local label = new("TextLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Font = Enum.Font.Gotham,
                Text = text,
                TextColor3 = currentTheme.Text,
                TextSize = 14,
                Position = UDim2.new(0, 10, 0, 0),
                Size = UDim2.new(0, 200, 1, 0),
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local toggleBtn = new("TextButton", {
                Parent = frame,
                BackgroundColor3 = toggled and currentTheme.Success or currentTheme.Disabled,
                AutoButtonColor = false,
                Text = "",
                Position = UDim2.new(1, -45, 0.5, -12),
                Size = UDim2.new(0, 40, 0, 24)
            })
            local toggleCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = toggleBtn})
            local circle = new("Frame", {
                Parent = toggleBtn,
                BackgroundColor3 = currentTheme.Text,
                Position = toggled and UDim2.new(1, -22, 0.5, -9) or UDim2.new(0, 2, 0.5, -9),
                Size = UDim2.new(0, 18, 0, 18)
            })
            local circleCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = circle})

            toggleBtn.MouseButton1Click:Connect(function()
                toggled = not toggled
                TweenService:Create(toggleBtn, TweenInfo.new(0.2), {BackgroundColor3 = toggled and currentTheme.Success or currentTheme.Disabled}):Play()
                TweenService:Create(circle, TweenInfo.new(0.2), {Position = toggled and UDim2.new(1, -22, 0.5, -9) or UDim2.new(0, 2, 0.5, -9)}):Play()
                safeCallback(callback, toggled)
            end)

            updateCanvas()
        end

        function pageElements:AddSlider(text, min, max, default, callback)
            local value = default or min
            local dragging = false
            local frame = new("Frame", {
                Parent = page,
                BackgroundColor3 = currentTheme.Second,
                BorderSizePixel = 0,
                Size = UDim2.new(0, page.AbsoluteSize.X - 20, 0, 55)
            })
            local frameCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = frame})

            local label = new("TextLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Font = Enum.Font.Gotham,
                Text = text,
                TextColor3 = currentTheme.Text,
                TextSize = 14,
                Position = UDim2.new(0, 10, 0, 5),
                Size = UDim2.new(0, 200, 0, 20),
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local valueLabel = new("TextLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Font = Enum.Font.Gotham,
                Text = tostring(value),
                TextColor3 = currentTheme.Text,
                TextSize = 14,
                Position = UDim2.new(1, -50, 0, 5),
                Size = UDim2.new(0, 40, 0, 20),
                TextXAlignment = Enum.TextXAlignment.Right
            })

            local sliderBg = new("Frame", {
                Parent = frame,
                BackgroundColor3 = currentTheme.Background,
                BorderSizePixel = 0,
                Position = UDim2.new(0, 10, 0, 30),
                Size = UDim2.new(1, -20, 0, 8)
            })
            local sliderBgCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = sliderBg})

            local fill = new("Frame", {
                Parent = sliderBg,
                BackgroundColor3 = currentTheme.Accent,
                BorderSizePixel = 0,
                Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
            })
            local fillCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = fill})

            local knob = new("TextButton", {
                Parent = sliderBg,
                BackgroundColor3 = currentTheme.Text,
                Text = "",
                Position = UDim2.new((value - min) / (max - min), -8, 0.5, -8),
                Size = UDim2.new(0, 16, 0, 16)
            })
            local knobCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = knob})

            knob.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = true
                end
            end)
            knob.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = false
                end
            end)

            local function update(input)
                local pos = math.clamp((input.Position.X - sliderBg.AbsolutePosition.X) / sliderBg.AbsoluteSize.X, 0, 1)
                value = math.floor(min + (max - min) * pos)
                fill:TweenSize(UDim2.new(pos, 0, 1, 0), "Out", "Quad", 0.1, true)
                knob:TweenPosition(UDim2.new(pos, -8, 0.5, -8), "Out", "Quad", 0.1, true)
                valueLabel.Text = tostring(value)
                safeCallback(callback, value)
            end

            UserInputService.InputChanged:Connect(function(input)
                if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    update(input)
                end
            end)

            updateCanvas()
        end

        function pageElements:AddDropdown(text, options, callback)
            local selected = text
            local expanded = false
            local frame = new("Frame", {
                Parent = page,
                BackgroundColor3 = currentTheme.Second,
                BorderSizePixel = 0,
                Size = UDim2.new(0, page.AbsoluteSize.X - 20, 0, 35)
            })
            local frameCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = frame})

            local label = new("TextLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Font = Enum.Font.Gotham,
                Text = text,
                TextColor3 = currentTheme.Text,
                TextSize = 14,
                Position = UDim2.new(0, 10, 0, 0),
                Size = UDim2.new(0, 200, 1, 0),
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local arrow = new("ImageLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Image = "rbxassetid://6034818372",
                ImageColor3 = currentTheme.Text,
                Size = UDim2.new(0, 20, 0, 20),
                Position = UDim2.new(1, -30, 0.5, -10)
            })

            local dropdownBtn = new("TextButton", {
                Parent = frame,
                BackgroundTransparency = 1,
                Text = "",
                Size = UDim2.new(1, 0, 1, 0)
            })

            local dropdownContainer = new("Frame", {
                Parent = page,
                BackgroundColor3 = currentTheme.Background,
                BorderSizePixel = 0,
                Position = UDim2.new(0, 10, 0, frame.AbsolutePosition.Y + 40),
                Size = UDim2.new(1, -20, 0, 0),
                Visible = false,
                ClipsDescendants = true,
                ZIndex = 5
            })
            local containerCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = dropdownContainer})
            local dropdownList = new("UIListLayout", {Parent = dropdownContainer, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 2)})

            -- Preencher opções
            for _, opt in ipairs(options) do
                local optBtn = new("TextButton", {
                    Parent = dropdownContainer,
                    BackgroundColor3 = currentTheme.Second,
                    AutoButtonColor = false,
                    Font = Enum.Font.Gotham,
                    Text = opt,
                    TextColor3 = currentTheme.Text,
                    TextSize = 14,
                    Size = UDim2.new(1, -10, 0, 25),
                    Position = UDim2.new(0, 5, 0, 0)
                })
                local optCorner = new("UICorner", {CornerRadius = UDim.new(0, 4), Parent = optBtn})
                optBtn.MouseButton1Click:Connect(function()
                    selected = opt
                    label.Text = text .. ": " .. opt
                    expanded = false
                    dropdownContainer.Visible = false
                    frame.Size = UDim2.new(0, page.AbsoluteSize.X - 20, 0, 35)
                    arrow.Rotation = 0
                    safeCallback(callback, opt)
                    updateCanvas()
                end)
            end

            dropdownBtn.MouseButton1Click:Connect(function()
                expanded = not expanded
                local height = math.min(#options * 27 + 10, 150)
                if expanded then
                    frame.Size = UDim2.new(0, page.AbsoluteSize.X - 20, 0, 35 + height)
                    dropdownContainer.Size = UDim2.new(1, -20, 0, height)
                    dropdownContainer.Visible = true
                    arrow.Rotation = 180
                else
                    frame.Size = UDim2.new(0, page.AbsoluteSize.X - 20, 0, 35)
                    dropdownContainer.Visible = false
                    arrow.Rotation = 0
                end
                updateCanvas()
            end)

            updateCanvas()
        end

        function pageElements:AddColorPicker(text, default, callback)
            -- Implementação completa de colorpicker com gradiente e seletor de matiz
            local color = default or currentTheme.Accent
            local expanded = false
            local hue, sat, val = Color3.toHSV(color)
            local rainbow = false

            local frame = new("Frame", {
                Parent = page,
                BackgroundColor3 = currentTheme.Second,
                BorderSizePixel = 0,
                Size = UDim2.new(0, page.AbsoluteSize.X - 20, 0, 35)
            })
            local frameCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = frame})

            local label = new("TextLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Font = Enum.Font.Gotham,
                Text = text,
                TextColor3 = currentTheme.Text,
                TextSize = 14,
                Position = UDim2.new(0, 10, 0, 0),
                Size = UDim2.new(0, 200, 1, 0),
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local colorBox = new("Frame", {
                Parent = frame,
                BackgroundColor3 = color,
                BorderSizePixel = 0,
                Position = UDim2.new(1, -45, 0.5, -12),
                Size = UDim2.new(0, 30, 0, 24)
            })
            local boxCorner = new("UICorner", {CornerRadius = UDim.new(0, 4), Parent = colorBox})

            local arrow = new("ImageLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Image = "rbxassetid://6034818372",
                ImageColor3 = currentTheme.Text,
                Size = UDim2.new(0, 20, 0, 20),
                Position = UDim2.new(1, -15, 0.5, -10)
            })

            local pickerBtn = new("TextButton", {
                Parent = frame,
                BackgroundTransparency = 1,
                Text = "",
                Size = UDim2.new(1, 0, 1, 0)
            })

            -- Container do colorpicker
            local pickerContainer = new("Frame", {
                Parent = page,
                BackgroundColor3 = currentTheme.Background,
                BorderSizePixel = 0,
                Position = UDim2.new(0, 10, 0, frame.AbsolutePosition.Y + 40),
                Size = UDim2.new(1, -20, 0, 0),
                Visible = false,
                ClipsDescendants = true,
                ZIndex = 5
            })
            local containerCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = pickerContainer})

            -- Área de seleção de cor (gradiente)
            local colorArea = new("ImageLabel", {
                Parent = pickerContainer,
                BackgroundColor3 = Color3.fromHSV(hue, 1, 1),
                Image = "rbxassetid://4155801252",
                Position = UDim2.new(0, 10, 0, 10),
                Size = UDim2.new(0, 200, 0, 150),
                ZIndex = 10
            })
            local colorCorner = new("UICorner", {CornerRadius = UDim.new(0, 4), Parent = colorArea})

            local selector = new("ImageLabel", {
                Parent = colorArea,
                BackgroundTransparency = 1,
                Image = "http://www.roblox.com/asset/?id=4805639000",
                Size = UDim2.new(0, 18, 0, 18),
                Position = UDim2.new(sat, -9, 1-val, -9),
                ZIndex = 11
            })

            -- Barra de matiz
            local hueBar = new("ImageLabel", {
                Parent = pickerContainer,
                BackgroundColor3 = Color3.fromRGB(255,255,255),
                Image = "rbxassetid://3679663627", -- Gradiente vertical
                Position = UDim2.new(0, 220, 0, 10),
                Size = UDim2.new(0, 20, 0, 150),
                ZIndex = 10
            })
            local hueCorner = new("UICorner", {CornerRadius = UDim.new(0, 4), Parent = hueBar})
            local hueSelector = new("ImageLabel", {
                Parent = hueBar,
                BackgroundTransparency = 1,
                Image = "http://www.roblox.com/asset/?id=4805639000",
                Size = UDim2.new(0, 18, 0, 18),
                Position = UDim2.new(0.5, -9, 1-hue, -9),
                ZIndex = 11
            })

            -- Botão Rainbow
            local rainbowToggle = new("Frame", {
                Parent = pickerContainer,
                BackgroundColor3 = currentTheme.Second,
                Position = UDim2.new(0, 250, 0, 10),
                Size = UDim2.new(0, 100, 0, 30)
            })
            local rainbowCorner = new("UICorner", {CornerRadius = UDim.new(0, 4), Parent = rainbowToggle})
            local rainbowLabel = new("TextLabel", {
                Parent = rainbowToggle,
                BackgroundTransparency = 1,
                Font = Enum.Font.Gotham,
                Text = "Rainbow",
                TextColor3 = currentTheme.Text,
                TextSize = 14,
                Position = UDim2.new(0, 5, 0, 0),
                Size = UDim2.new(0, 60, 1, 0),
                TextXAlignment = Enum.TextXAlignment.Left
            })
            local rainbowBox = new("Frame", {
                Parent = rainbowToggle,
                BackgroundColor3 = currentTheme.Disabled,
                Position = UDim2.new(1, -30, 0.5, -8),
                Size = UDim2.new(0, 25, 0, 16)
            })
            local rainbowBoxCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = rainbowBox})
            local rainbowCircle = new("Frame", {
                Parent = rainbowBox,
                BackgroundColor3 = currentTheme.Text,
                Position = UDim2.new(0, 2, 0.5, -6),
                Size = UDim2.new(0, 12, 0, 12)
            })
            local rainbowCircleCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = rainbowCircle})
            local rainbowBtn = new("TextButton", {
                Parent = rainbowToggle,
                BackgroundTransparency = 1,
                Text = "",
                Size = UDim2.new(1, 0, 1, 0)
            })

            -- Botão Confirmar
            local confirmBtn = new("TextButton", {
                Parent = pickerContainer,
                BackgroundColor3 = currentTheme.Accent,
                Text = "Confirmar",
                Font = Enum.Font.Gotham,
                TextColor3 = currentTheme.Text,
                TextSize = 14,
                Position = UDim2.new(0, 250, 0, 50),
                Size = UDim2.new(0, 100, 0, 30)
            })
            local confirmCorner = new("UICorner", {CornerRadius = UDim.new(0, 4), Parent = confirmBtn})

            -- Lógica de arrasto para seletores
            local colorDragging = false
            local hueDragging = false

            colorArea.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    colorDragging = true
                end
            end)
            colorArea.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    colorDragging = false
                end
            end)

            hueBar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    hueDragging = true
                end
            end)
            hueBar.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    hueDragging = false
                end
            end)

            local function updateColorFromInput(input)
                if colorDragging then
                    local x = math.clamp((input.Position.X - colorArea.AbsolutePosition.X) / colorArea.AbsoluteSize.X, 0, 1)
                    local y = math.clamp((input.Position.Y - colorArea.AbsolutePosition.Y) / colorArea.AbsoluteSize.Y, 0, 1)
                    sat = x
                    val = 1 - y
                    selector.Position = UDim2.new(sat, -9, val, -9)
                    color = Color3.fromHSV(hue, sat, val)
                    colorBox.BackgroundColor3 = color
                elseif hueDragging then
                    local y = math.clamp((input.Position.Y - hueBar.AbsolutePosition.Y) / hueBar.AbsoluteSize.Y, 0, 1)
                    hue = 1 - y
                    hueSelector.Position = UDim2.new(0.5, -9, y, -9)
                    colorArea.BackgroundColor3 = Color3.fromHSV(hue, 1, 1)
                    color = Color3.fromHSV(hue, sat, val)
                    colorBox.BackgroundColor3 = color
                end
            end

            UserInputService.InputChanged:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseMovement then
                    updateColorFromInput(input)
                end
            end)

            -- Rainbow toggle
            rainbowBtn.MouseButton1Click:Connect(function()
                rainbow = not rainbow
                local targetPos = rainbow and UDim2.new(1, -14, 0.5, -6) or UDim2.new(0, 2, 0.5, -6)
                TweenService:Create(rainbowCircle, TweenInfo.new(0.2), {Position = targetPos}):Play()
                if rainbow then
                    -- Inicia loop rainbow
                    task.spawn(function()
                        while rainbow do
                            color = Color3.fromHSV((tick() % 5) / 5, 1, 1)
                            colorBox.BackgroundColor3 = color
                            safeCallback(callback, color)
                            task.wait(0.05)
                        end
                    end)
                else
                    -- Restaura cor atual
                    colorBox.BackgroundColor3 = color
                    safeCallback(callback, color)
                end
            end)

            confirmBtn.MouseButton1Click:Connect(function()
                expanded = false
                pickerContainer.Visible = false
                frame.Size = UDim2.new(0, page.AbsoluteSize.X - 20, 0, 35)
                arrow.Rotation = 0
                updateCanvas()
                safeCallback(callback, color)
            end)

            pickerBtn.MouseButton1Click:Connect(function()
                expanded = not expanded
                if expanded then
                    frame.Size = UDim2.new(0, page.AbsoluteSize.X - 20, 0, 35 + 180)
                    pickerContainer.Size = UDim2.new(1, -20, 0, 180)
                    pickerContainer.Visible = true
                    arrow.Rotation = 180
                else
                    frame.Size = UDim2.new(0, page.AbsoluteSize.X - 20, 0, 35)
                    pickerContainer.Visible = false
                    arrow.Rotation = 0
                end
                updateCanvas()
            end)

            updateCanvas()
        end

        function pageElements:AddTextbox(text, placeholder, callback, multiline)
            local frame = new("Frame", {
                Parent = page,
                BackgroundColor3 = currentTheme.Second,
                BorderSizePixel = 0,
                Size = UDim2.new(0, page.AbsoluteSize.X - 20, 0, 50)
            })
            local frameCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = frame})

            local label = new("TextLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Font = Enum.Font.Gotham,
                Text = text,
                TextColor3 = currentTheme.Text,
                TextSize = 14,
                Position = UDim2.new(0, 10, 0, 5),
                Size = UDim2.new(0, 200, 0, 20),
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local boxFrame = new("Frame", {
                Parent = frame,
                BackgroundColor3 = currentTheme.Background,
                Position = UDim2.new(0, 10, 0, 30),
                Size = UDim2.new(1, -20, 0, 25)
            })
            local boxCorner = new("UICorner", {CornerRadius = UDim.new(0, 4), Parent = boxFrame})

            local textBox = new("TextBox", {
                Parent = boxFrame,
                BackgroundTransparency = 1,
                Font = Enum.Font.Gotham,
                PlaceholderText = placeholder,
                Text = "",
                TextColor3 = currentTheme.Text,
                TextSize = 14,
                Size = UDim2.new(1, -10, 1, 0),
                Position = UDim2.new(0, 5, 0, 0),
                ClearTextOnFocus = false
            })

            textBox.FocusLost:Connect(function(enterPressed)
                if enterPressed then
                    safeCallback(callback, textBox.Text)
                end
            end)

            updateCanvas()
        end

        function pageElements:AddLabel(text)
            local label = new("TextLabel", {
                Parent = page,
                BackgroundColor3 = currentTheme.Second,
                Font = Enum.Font.Gotham,
                Text = text,
                TextColor3 = currentTheme.Text,
                TextSize = 14,
                Size = UDim2.new(0, page.AbsoluteSize.X - 20, 0, 30)
            })
            local labelCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = label})
            updateCanvas()
        end

        return pageElements
    end

    return {
        AddTab = tabs.AddTab,
        Notify = notify
    }
end

return AxiomXLib

-- AxiomX Library - Modern UI Library for Roblox
-- Load via loadstring: local AxiomX = loadstring(game:HttpGet("https://raw.githubusercontent.com/.../axiomx.lua"))()

local AxiomX = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- Default theme (Glassmorphism)
local defaultTheme = {
    Background = Color3.fromRGB(20, 20, 30),
    Foreground = Color3.fromRGB(30, 30, 45),
    Accent = Color3.fromRGB(100, 150, 255),
    Text = Color3.fromRGB(240, 240, 240),
    SubText = Color3.fromRGB(180, 180, 180),
    Shadow = Color3.fromRGB(0, 0, 0),
    Transparency = 0.2,
    CornerRadius = UDim.new(0, 8),
    Font = Enum.Font.Gotham,
    TextSize = 14,
    TweenDuration = 0.3,
}

local currentTheme = defaultTheme

-- Helper function to create instances
local function createInstance(className, properties)
    local obj = Instance.new(className)
    for prop, value in pairs(properties) do
        obj[prop] = value
    end
    return obj
end

-- Tween helper
local function tweenObject(obj, goal, duration, style, direction)
    style = style or Enum.EasingStyle.Quad
    direction = direction or Enum.EasingDirection.Out
    local tweenInfo = TweenInfo.new(duration or currentTheme.TweenDuration, style, direction)
    local tween = TweenService:Create(obj, tweenInfo, goal)
    tween:Play()
    return tween
end

-- Drag handler for PC and mobile
local function makeDraggable(dragHandle, targetFrame)
    local dragging = false
    local dragStart = nil
    local startPos = nil

    local function updateInput(input)
        if dragging then
            local delta = input.Position - dragStart
            targetFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end

    dragHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = targetFrame.Position
        end
    end)

    dragHandle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            updateInput(input)
        end
    end)

    dragHandle.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)

    -- For touch, we also need to track on InputChanged globally (touch moves)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.Touch) then
            updateInput(input)
        end
    end)
end

-- Notification system
function AxiomX:Notify(config)
    config = config or {}
    local title = config.Title or "Notification"
    local message = config.Message or ""
    local duration = config.Duration or 3
    local theme = config.Theme or currentTheme

    -- Create notification holder (if not exists)
    local notificationHolder = AxiomX._notificationHolder
    if not notificationHolder then
        notificationHolder = createInstance("ScreenGui", {
            Name = "AxiomX_Notifications",
            Parent = Players.LocalPlayer:WaitForChild("PlayerGui"),
            IgnoreGuiInset = true,
        })
        AxiomX._notificationHolder = notificationHolder
    end

    -- Create notification frame
    local notif = createInstance("Frame", {
        Size = UDim2.new(0, 300, 0, 80),
        Position = UDim2.new(0.5, -150, 0, -100), -- start above screen
        BackgroundColor3 = theme.Background,
        BackgroundTransparency = theme.Transparency,
        BorderSizePixel = 0,
        Parent = notificationHolder,
        ClipsDescendants = true,
    })
    local corner = createInstance("UICorner", { CornerRadius = theme.CornerRadius, Parent = notif })

    -- Shadow
    local shadow = createInstance("ImageLabel", {
        Name = "Shadow",
        BackgroundTransparency = 1,
        Image = "rbxassetid://6015897843", -- shadow asset
        ImageTransparency = 0.5,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(10, 10, 10, 10),
        Size = UDim2.new(1, 10, 1, 10),
        Position = UDim2.new(0, -5, 0, -5),
        Parent = notif,
        ZIndex = -1,
    })

    -- Title
    local titleLabel = createInstance("TextLabel", {
        Size = UDim2.new(1, -20, 0, 20),
        Position = UDim2.new(0, 10, 0, 10),
        BackgroundTransparency = 1,
        Text = title,
        Font = theme.Font,
        TextSize = theme.TextSize + 2,
        TextColor3 = theme.Accent,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = notif,
    })

    -- Message
    local msgLabel = createInstance("TextLabel", {
        Size = UDim2.new(1, -20, 0, 40),
        Position = UDim2.new(0, 10, 0, 30),
        BackgroundTransparency = 1,
        Text = message,
        Font = theme.Font,
        TextSize = theme.TextSize,
        TextColor3 = theme.Text,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true,
        Parent = notif,
    })

    -- Animate in
    tweenObject(notif, { Position = UDim2.new(0.5, -150, 0, 20) }, 0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out)

    -- Auto destroy after duration
    task.wait(duration)
    tweenObject(notif, { Position = UDim2.new(0.5, -150, 0, -100) }, 0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
    task.wait(0.3)
    notif:Destroy()
end

-- Create main window
function AxiomX:CreateWindow(config)
    config = config or {}
    local title = config.Title or "AxiomX"
    local size = config.Size or UDim2.new(0, 600, 0, 400)
    local theme = config.Theme or currentTheme

    -- Create ScreenGui
    local gui = createInstance("ScreenGui", {
        Name = "AxiomX_Window",
        Parent = Players.LocalPlayer:WaitForChild("PlayerGui"),
        IgnoreGuiInset = true,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
    })

    -- Main window frame
    local window = createInstance("Frame", {
        Size = size,
        Position = UDim2.new(0.5, -size.X.Offset/2, 0.5, -size.Y.Offset/2),
        BackgroundColor3 = theme.Background,
        BackgroundTransparency = theme.Transparency,
        BorderSizePixel = 0,
        Parent = gui,
        ClipsDescendants = true,
    })
    local corner = createInstance("UICorner", { CornerRadius = theme.CornerRadius, Parent = window })

    -- Shadow
    local shadow = createInstance("ImageLabel", {
        Name = "Shadow",
        BackgroundTransparency = 1,
        Image = "rbxassetid://6015897843",
        ImageTransparency = 0.5,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(10, 10, 10, 10),
        Size = UDim2.new(1, 10, 1, 10),
        Position = UDim2.new(0, -5, 0, -5),
        Parent = window,
        ZIndex = -1,
    })

    -- Top bar (for dragging)
    local topBar = createInstance("Frame", {
        Size = UDim2.new(1, 0, 0, 30),
        BackgroundColor3 = theme.Foreground,
        BackgroundTransparency = theme.Transparency,
        BorderSizePixel = 0,
        Parent = window,
    })
    local topBarCorner = createInstance("UICorner", { CornerRadius = UDim.new(0, 8), Parent = topBar }) -- corner radius for top bar only top edges

    -- Title label
    local titleLabel = createInstance("TextLabel", {
        Size = UDim2.new(1, -40, 1, 0),
        Position = UDim2.new(0, 10, 0, 0),
        BackgroundTransparency = 1,
        Text = title,
        Font = theme.Font,
        TextSize = theme.TextSize + 2,
        TextColor3 = theme.Accent,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = topBar,
    })

    -- Close button (optional)
    local closeBtn = createInstance("TextButton", {
        Size = UDim2.new(0, 30, 0, 30),
        Position = UDim2.new(1, -30, 0, 0),
        BackgroundTransparency = 1,
        Text = "Ã—",
        TextColor3 = theme.Text,
        TextSize = 20,
        Font = Enum.Font.GothamBold,
        Parent = topBar,
    })
    closeBtn.MouseButton1Click:Connect(function()
        gui:Destroy()
    end)

    -- Tabs container
    local tabsContainer = createInstance("Frame", {
        Size = UDim2.new(1, 0, 0, 40),
        Position = UDim2.new(0, 0, 0, 30),
        BackgroundTransparency = 1,
        Parent = window,
    })

    -- Content container (where tab content goes)
    local contentContainer = createInstance("Frame", {
        Size = UDim2.new(1, -20, 1, -90), -- minus padding and top bar + tabs
        Position = UDim2.new(0, 10, 0, 80),
        BackgroundTransparency = 1,
        Parent = window,
    })

    -- Make window draggable via top bar
    makeDraggable(topBar, window)

    -- Table to store tabs
    local tabs = {}
    local activeTab = nil

    -- Tab creation method
    function window:CreateTab(name, icon)
        icon = icon or "" -- icon could be a text emoji or an ImageLabel later

        -- Create tab button
        local tabBtn = createInstance("TextButton", {
            Size = UDim2.new(0, 100, 1, -10),
            Position = UDim2.new(0, #tabs * 110, 0, 5),
            BackgroundColor3 = theme.Foreground,
            BackgroundTransparency = theme.Transparency,
            BorderSizePixel = 0,
            Text = icon .. " " .. name,
            Font = theme.Font,
            TextSize = theme.TextSize,
            TextColor3 = theme.Text,
            Parent = tabsContainer,
            AutoButtonColor = false,
        })
        local btnCorner = createInstance("UICorner", { CornerRadius = theme.CornerRadius, Parent = tabBtn })

        -- Create content frame for this tab (initially hidden)
        local content = createInstance("ScrollingFrame", {
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            ScrollBarThickness = 4,
            ScrollBarImageColor3 = theme.Accent,
            Visible = false,
            Parent = contentContainer,
            CanvasSize = UDim2.new(0, 0, 0, 0),
        })
        local uiList = createInstance("UIListLayout", {
            Padding = UDim.new(0, 8),
            HorizontalAlignment = Enum.HorizontalAlignment.Center,
            SortOrder = Enum.SortOrder.LayoutOrder,
            Parent = content,
        })
        uiList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            content.CanvasSize = UDim2.new(0, 0, 0, uiList.AbsoluteContentSize.Y + 20)
        end)

        -- Tab object
        local tabObj = {
            Name = name,
            Button = tabBtn,
            Content = content,
            Elements = {},
        }

        -- Button click to switch tab
        tabBtn.MouseButton1Click:Connect(function()
            if activeTab then
                activeTab.Content.Visible = false
                -- reset button style maybe
            end
            content.Visible = true
            activeTab = tabObj
            -- highlight active tab button
            for _, t in pairs(tabs) do
                t.Button.BackgroundColor3 = theme.Foreground
            end
            tabBtn.BackgroundColor3 = theme.Accent
        end)

        -- Method to add UI elements to this tab
        function tabObj:CreateButton(btnConfig)
            btnConfig = btnConfig or {}
            local btnText = btnConfig.Text or "Button"
            local callback = btnConfig.Callback or function() end

            local btn = createInstance("TextButton", {
                Size = UDim2.new(1, -20, 0, 35),
                BackgroundColor3 = theme.Foreground,
                BackgroundTransparency = theme.Transparency,
                BorderSizePixel = 0,
                Text = btnText,
                Font = theme.Font,
                TextSize = theme.TextSize,
                TextColor3 = theme.Text,
                Parent = content,
                AutoButtonColor = false,
            })
            local btnCorner = createInstance("UICorner", { CornerRadius = theme.CornerRadius, Parent = btn })

            -- Hover animation
            btn.MouseEnter:Connect(function()
                tweenObject(btn, { BackgroundColor3 = theme.Accent }, 0.2)
            end)
            btn.MouseLeave:Connect(function()
                tweenObject(btn, { BackgroundColor3 = theme.Foreground }, 0.2)
            end)

            btn.MouseButton1Click:Connect(callback)

            return btn
        end

        function tabObj:CreateToggle(toggleConfig)
            toggleConfig = toggleConfig or {}
            local label = toggleConfig.Label or "Toggle"
            local default = toggleConfig.Default or false
            local callback = toggleConfig.Callback or function() end

            local frame = createInstance("Frame", {
                Size = UDim2.new(1, -20, 0, 35),
                BackgroundTransparency = 1,
                Parent = content,
            })

            local labelObj = createInstance("TextLabel", {
                Size = UDim2.new(0.7, -10, 1, 0),
                BackgroundTransparency = 1,
                Text = label,
                Font = theme.Font,
                TextSize = theme.TextSize,
                TextColor3 = theme.Text,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = frame,
            })

            local toggleBg = createInstance("Frame", {
                Size = UDim2.new(0, 50, 0, 25),
                Position = UDim2.new(1, -60, 0.5, -12.5),
                BackgroundColor3 = default and theme.Accent or theme.Foreground,
                BackgroundTransparency = theme.Transparency,
                BorderSizePixel = 0,
                Parent = frame,
            })
            local bgCorner = createInstance("UICorner", { CornerRadius = UDim.new(1, 0), Parent = toggleBg }) -- pill shape

            local toggleKnob = createInstance("Frame", {
                Size = UDim2.new(0, 21, 0, 21),
                Position = UDim2.new(0, default and 27 or 2, 0.5, -10.5),
                BackgroundColor3 = theme.Text,
                BorderSizePixel = 0,
                Parent = toggleBg,
            })
            local knobCorner = createInstance("UICorner", { CornerRadius = UDim.new(1, 0), Parent = toggleKnob })

            local state = default
            local function updateToggle()
                tweenObject(toggleBg, { BackgroundColor3 = state and theme.Accent or theme.Foreground }, 0.2)
                tweenObject(toggleKnob, { Position = UDim2.new(0, state and 27 or 2, 0.5, -10.5) }, 0.2)
                callback(state)
            end

            toggleBg.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    state = not state
                    updateToggle()
                end
            end)

            updateToggle() -- ensure initial state

            return frame
        end

        function tabObj:CreateSlider(sliderConfig)
            sliderConfig = sliderConfig or {}
            local label = sliderConfig.Label or "Slider"
            local min = sliderConfig.Min or 0
            local max = sliderConfig.Max or 100
            local default = sliderConfig.Default or min
            local callback = sliderConfig.Callback or function() end

            local frame = createInstance("Frame", {
                Size = UDim2.new(1, -20, 0, 50),
                BackgroundTransparency = 1,
                Parent = content,
            })

            local labelObj = createInstance("TextLabel", {
                Size = UDim2.new(0.5, -10, 0, 20),
                BackgroundTransparency = 1,
                Text = label,
                Font = theme.Font,
                TextSize = theme.TextSize,
                TextColor3 = theme.Text,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = frame,
            })

            local valueLabel = createInstance("TextLabel", {
                Size = UDim2.new(0.5, -10, 0, 20),
                Position = UDim2.new(0.5, 0, 0, 0),
                BackgroundTransparency = 1,
                Text = tostring(default),
                Font = theme.Font,
                TextSize = theme.TextSize,
                TextColor3 = theme.Accent,
                TextXAlignment = Enum.TextXAlignment.Right,
                Parent = frame,
            })

            local sliderBg = createInstance("Frame", {
                Size = UDim2.new(1, -20, 0, 10),
                Position = UDim2.new(0, 10, 0, 25),
                BackgroundColor3 = theme.Foreground,
                BackgroundTransparency = theme.Transparency,
                BorderSizePixel = 0,
                Parent = frame,
            })
            local bgCorner = createInstance("UICorner", { CornerRadius = UDim.new(1, 0), Parent = sliderBg })

            local fill = createInstance("Frame", {
                Size = UDim2.new((default - min)/(max - min), 0, 1, 0),
                BackgroundColor3 = theme.Accent,
                BorderSizePixel = 0,
                Parent = sliderBg,
            })
            local fillCorner = createInstance("UICorner", { CornerRadius = UDim.new(1, 0), Parent = fill })

            local knob = createInstance("Frame", {
                Size = UDim2.new(0, 16, 0, 16),
                Position = UDim2.new((default - min)/(max - min), -8, 0.5, -8),
                BackgroundColor3 = theme.Text,
                BorderSizePixel = 0,
                Parent = sliderBg,
                ZIndex = 2,
            })
            local knobCorner = createInstance("UICorner", { CornerRadius = UDim.new(1, 0), Parent = knob })

            local dragging = false

            local function updateSlider(inputPos)
                local localPos = sliderBg.AbsolutePosition
                local relativeX = math.clamp(inputPos.X - localPos.X, 0, sliderBg.AbsoluteSize.X)
                local percent = relativeX / sliderBg.AbsoluteSize.X
                local value = min + (max - min) * percent
                value = math.floor(value + 0.5) -- integer for simplicity
                percent = (value - min) / (max - min)

                fill.Size = UDim2.new(percent, 0, 1, 0)
                knob.Position = UDim2.new(percent, -8, 0.5, -8)
                valueLabel.Text = tostring(value)
                callback(value)
            end

            sliderBg.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = true
                    updateSlider(input.Position)
                end
            end)

            UserInputService.InputChanged:Connect(function(input)
                if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                    updateSlider(input.Position)
                end
            end)

            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = false
                end
            end)

            return frame
        end

        table.insert(tabs, tabObj)
        if not activeTab then
            -- first tab, activate it
            tabBtn.BackgroundColor3 = theme.Accent
            content.Visible = true
            activeTab = tabObj
        end

        return tabObj
    end

    function window:Destroy()
        gui:Destroy()
    end

    function window:SetVisible(visible)
        gui.Enabled = visible
    end

    return window
end

-- Set custom theme
function AxiomX:SetTheme(newTheme)
    currentTheme = newTheme
end

return AxiomX

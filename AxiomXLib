-- AxiomXLib.lua
-- UI Fluente estilo Windows 11

local AxiomXLib = {}
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Temas
local themes = {
    Light = {
        Background = Color3.fromRGB(243, 243, 243),
        Surface = Color3.fromRGB(255, 255, 255),
        Primary = Color3.fromRGB(0, 120, 212),
        Secondary = Color3.fromRGB(230, 230, 230),
        Text = Color3.fromRGB(0, 0, 0),
        TextSecondary = Color3.fromRGB(96, 96, 96),
        Border = Color3.fromRGB(200, 200, 200),
        Shadow = Color3.fromRGB(0, 0, 0),
        ShadowTransparency = 0.8,
        Success = Color3.fromRGB(16, 124, 16),
        Danger = Color3.fromRGB(196, 43, 28),
        Warning = Color3.fromRGB(255, 193, 7)
    },
    Dark = {
        Background = Color3.fromRGB(32, 32, 32),
        Surface = Color3.fromRGB(45, 45, 45),
        Primary = Color3.fromRGB(0, 120, 212),
        Secondary = Color3.fromRGB(60, 60, 60),
        Text = Color3.fromRGB(255, 255, 255),
        TextSecondary = Color3.fromRGB(200, 200, 200),
        Border = Color3.fromRGB(80, 80, 80),
        Shadow = Color3.fromRGB(0, 0, 0),
        ShadowTransparency = 0.6,
        Success = Color3.fromRGB(76, 175, 80),
        Danger = Color3.fromRGB(244, 67, 54),
        Warning = Color3.fromRGB(255, 193, 7)
    }
}

local currentTheme = themes.Dark

-- Utilitários
local function new(class, props)
    local obj = Instance.new(class)
    for k, v in pairs(props) do
        obj[k] = v
    end
    return obj
end

local function safeCallback(callback, ...)
    if callback then
        local success, err = pcall(callback, ...)
        if not success then
            warn("AxiomXLib: Erro no callback:", err)
        end
    end
end

local function makeDraggable(dragHandle, target)
    local dragging, dragStart, startPos
    dragHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = target.Position
        end
    end)
    dragHandle.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            target.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
end

-- Sistema de notificações (toast)
local function createNotificationSystem(parent)
    local holder = new("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -340, 0, 60),
        Size = UDim2.new(0, 320, 1, -120),
        ClipsDescendants = true
    })

    local function notify(config)
        config = config or {}
        local title = config.title or "Notificação"
        local message = config.message or ""
        local duration = config.duration or 3
        local style = config.style or "info"
        local callback = config.callback

        local colors = {
            info = currentTheme.Primary,
            success = currentTheme.Success,
            error = currentTheme.Danger,
            warning = currentTheme.Warning
        }
        local accentColor = colors[style] or currentTheme.Primary

        local notif = new("Frame", {
            Parent = holder,
            BackgroundColor3 = currentTheme.Surface,
            BorderSizePixel = 0,
            Position = UDim2.new(0, 340, 0, 0),
            Size = UDim2.new(1, -10, 0, 90),
            ClipsDescendants = true
        })
        local notifCorner = new("UICorner", {CornerRadius = UDim.new(0, 8), Parent = notif})

        -- Sombra
        local shadow = new("ImageLabel", {
            Parent = notif,
            BackgroundTransparency = 1,
            Image = "rbxassetid://1316045217",
            ImageColor3 = currentTheme.Shadow,
            ImageTransparency = currentTheme.ShadowTransparency,
            ScaleType = Enum.ScaleType.Slice,
            SliceCenter = Rect.new(10, 10, 118, 118),
            Position = UDim2.new(0, -5, 0, -5),
            Size = UDim2.new(1, 10, 1, 10),
            ZIndex = 0
        })

        -- Barra lateral colorida
        local bar = new("Frame", {
            Parent = notif,
            BackgroundColor3 = accentColor,
            BorderSizePixel = 0,
            Position = UDim2.new(0, 0, 0, 0),
            Size = UDim2.new(0, 4, 1, 0)
        })

        local titleLabel = new("TextLabel", {
            Parent = notif,
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamSemibold,
            Text = title,
            TextColor3 = currentTheme.Text,
            TextSize = 16,
            Position = UDim2.new(0, 16, 0, 12),
            Size = UDim2.new(1, -50, 0, 22),
            TextXAlignment = Enum.TextXAlignment.Left
        })

        local messageLabel = new("TextLabel", {
            Parent = notif,
            BackgroundTransparency = 1,
            Font = Enum.Font.Gotham,
            Text = message,
            TextColor3 = currentTheme.TextSecondary,
            TextSize = 14,
            Position = UDim2.new(0, 16, 0, 36),
            Size = UDim2.new(1, -50, 0, 42),
            TextWrapped = true,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextYAlignment = Enum.TextYAlignment.Top
        })

        local closeBtn = new("TextButton", {
            Parent = notif,
            BackgroundTransparency = 1,
            Text = "",
            Position = UDim2.new(1, -30, 0, 8),
            Size = UDim2.new(0, 24, 0, 24)
        })
        local closeIcon = new("ImageLabel", {
            Parent = closeBtn,
            BackgroundTransparency = 1,
            Image = "rbxassetid://6035047409",
            ImageColor3 = currentTheme.TextSecondary,
            Size = UDim2.new(0, 16, 0, 16),
            Position = UDim2.new(0.5, -8, 0.5, -8)
        })

        notif:TweenPosition(UDim2.new(0, 5, 0, 0), "Out", "Quad", 0.4, true)

        task.delay(duration, function()
            notif:TweenPosition(UDim2.new(0, 340, 0, 0), "Out", "Quad", 0.4, true)
            task.wait(0.4)
            notif:Destroy()
            safeCallback(callback)
        end)

        closeBtn.MouseButton1Click:Connect(function()
            notif:TweenPosition(UDim2.new(0, 340, 0, 0), "Out", "Quad", 0.4, true)
            task.wait(0.4)
            notif:Destroy()
        end)
    end

    return notify
end

-- Função principal: criar janela
function AxiomXLib:CreateWindow(config)
    config = config or {}
    local title = config.title or "AxiomX"
    local size = config.size or UDim2.new(0, 800, 0, 600)
    local theme = config.theme or "Dark"
    local closeBind = config.closeBind or Enum.KeyCode.RightControl
    currentTheme = themes[theme] or themes.Dark

    local gui = new("ScreenGui", {
        Name = "AxiomXLib",
        Parent = game:GetService("CoreGui"),
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 100
    })

    -- Janela principal
    local main = new("Frame", {
        Parent = gui,
        BackgroundColor3 = currentTheme.Background,
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, -size.X.Offset/2, 0.5, -size.Y.Offset/2),
        Size = size,
        ClipsDescendants = true
    })
    local mainCorner = new("UICorner", {CornerRadius = UDim.new(0, 10), Parent = main})

    -- Sombra
    local shadow = new("ImageLabel", {
        Parent = main,
        BackgroundTransparency = 1,
        Image = "rbxassetid://1316045217",
        ImageColor3 = currentTheme.Shadow,
        ImageTransparency = currentTheme.ShadowTransparency,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(10, 10, 118, 118),
        Position = UDim2.new(0, -10, 0, -10),
        Size = UDim2.new(1, 20, 1, 20),
        ZIndex = 0
    })

    -- Top bar
    local topbar = new("Frame", {
        Parent = main,
        BackgroundColor3 = currentTheme.Surface,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 48)
    })
    local topCorner = new("UICorner", {CornerRadius = UDim.new(0, 10), Parent = topbar})
    -- Esconde os cantos inferiores
    local topMask = new("Frame", {
        Parent = topbar,
        BackgroundColor3 = currentTheme.Surface,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 1, 0),
        Size = UDim2.new(1, 0, 0, 10)
    })

    local titleLabel = new("TextLabel", {
        Parent = topbar,
        BackgroundTransparency = 1,
        Font = Enum.Font.GothamSemibold,
        Text = title,
        TextColor3 = currentTheme.Text,
        TextSize = 20,
        Position = UDim2.new(0, 16, 0, 0),
        Size = UDim2.new(0, 200, 1, 0),
        TextXAlignment = Enum.TextXAlignment.Left
    })

    -- Botões de janela
    local closeBtn = new("TextButton", {
        Parent = topbar,
        BackgroundTransparency = 1,
        Text = "",
        Position = UDim2.new(1, -54, 0.5, -14),
        Size = UDim2.new(0, 36, 0, 28)
    })
    local closeIcon = new("ImageLabel", {
        Parent = closeBtn,
        BackgroundTransparency = 1,
        Image = "rbxassetid://6035047409",
        ImageColor3 = currentTheme.TextSecondary,
        Size = UDim2.new(0, 20, 0, 20),
        Position = UDim2.new(0.5, -10, 0.5, -10)
    })
    closeBtn.MouseEnter:Connect(function() closeIcon.ImageColor3 = currentTheme.Danger end)
    closeBtn.MouseLeave:Connect(function() closeIcon.ImageColor3 = currentTheme.TextSecondary end)
    closeBtn.MouseButton1Click:Connect(function()
        main:TweenSize(UDim2.new(0,0,0,0), "Out", "Quad", 0.3, true, function() gui:Destroy() end)
    end)

    local maximizeBtn = new("TextButton", {
        Parent = topbar,
        BackgroundTransparency = 1,
        Text = "",
        Position = UDim2.new(1, -94, 0.5, -14),
        Size = UDim2.new(0, 36, 0, 28)
    })
    local maximizeIcon = new("ImageLabel", {
        Parent = maximizeBtn,
        BackgroundTransparency = 1,
        Image = "rbxassetid://6035067836", -- ícone de maximizar (ou quadrado)
        ImageColor3 = currentTheme.TextSecondary,
        Size = UDim2.new(0, 20, 0, 20),
        Position = UDim2.new(0.5, -10, 0.5, -10)
    })
    local maximized = false
    local originalSize = size
    maximizeBtn.MouseButton1Click:Connect(function()
        maximized = not maximized
        if maximized then
            main:TweenSize(UDim2.new(1, 0, 1, 0), "Out", "Quad", 0.25)
            main.Position = UDim2.new(0, 0, 0, 0)
        else
            main:TweenSize(originalSize, "Out", "Quad", 0.25)
            main.Position = UDim2.new(0.5, -originalSize.X.Offset/2, 0.5, -originalSize.Y.Offset/2)
        end
    end)

    local minimizeBtn = new("TextButton", {
        Parent = topbar,
        BackgroundTransparency = 1,
        Text = "",
        Position = UDim2.new(1, -134, 0.5, -14),
        Size = UDim2.new(0, 36, 0, 28)
    })
    local minimizeIcon = new("ImageLabel", {
        Parent = minimizeBtn,
        BackgroundTransparency = 1,
        Image = "rbxassetid://6035067836", -- ícone de minimizar (traço)
        ImageColor3 = currentTheme.TextSecondary,
        Size = UDim2.new(0, 20, 0, 20),
        Position = UDim2.new(0.5, -10, 0.5, -10)
    })
    local minimized = false
    minimizeBtn.MouseButton1Click:Connect(function()
        minimized = not minimized
        local newSize = minimized and UDim2.new(size.X.Scale, size.X.Offset, 0, 48) or size
        main:TweenSize(newSize, "Out", "Quad", 0.25)
    end)

    makeDraggable(topbar, main)

    -- Container principal
    local container = new("Frame", {
        Parent = main,
        BackgroundColor3 = currentTheme.Background,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 48),
        Size = UDim2.new(1, 0, 1, -48)
    })

    -- Sidebar com abas
    local sidebar = new("Frame", {
        Parent = container,
        BackgroundColor3 = currentTheme.Surface,
        BorderSizePixel = 0,
        Size = UDim2.new(0, 220, 1, 0)
    })
    local sidebarCorner = new("UICorner", {CornerRadius = UDim.new(0, 10), Parent = sidebar})
    local sidebarMask = new("Frame", {
        Parent = sidebar,
        BackgroundColor3 = currentTheme.Surface,
        BorderSizePixel = 0,
        Position = UDim2.new(1, -10, 0, 0),
        Size = UDim2.new(0, 10, 1, 0)
    })

    local tabList = new("UIListLayout", {
        Parent = sidebar,
        FillDirection = Enum.FillDirection.Vertical,
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 8)
    })
    local tabPadding = new("UIPadding", {Parent = sidebar, PaddingTop = UDim.new(0, 16)})

    -- Conteúdo (páginas)
    local content = new("Frame", {
        Parent = container,
        BackgroundColor3 = currentTheme.Background,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 220, 0, 0),
        Size = UDim2.new(1, -220, 1, 0)
    })

    -- Header do conteúdo (mostra o título da aba ativa)
    local contentHeader = new("Frame", {
        Parent = content,
        BackgroundColor3 = currentTheme.Surface,
        BorderSizePixel = 0,
        Size = UDim2.new(1, -20, 0, 48),
        Position = UDim2.new(0, 10, 0, 10)
    })
    local headerCorner = new("UICorner", {CornerRadius = UDim.new(0, 8), Parent = contentHeader})
    local headerTitle = new("TextLabel", {
        Parent = contentHeader,
        BackgroundTransparency = 1,
        Font = Enum.Font.GothamSemibold,
        Text = "",
        TextColor3 = currentTheme.Text,
        TextSize = 18,
        Position = UDim2.new(0, 16, 0, 0),
        Size = UDim2.new(1, -32, 1, 0),
        TextXAlignment = Enum.TextXAlignment.Left
    })

    local pages = {}
    local currentPage

    -- Notificações
    local notify = createNotificationSystem(gui)

    -- Abas
    local tabs = {}

    function tabs:AddTab(name, icon)
        local tabBtn = new("TextButton", {
            Parent = sidebar,
            BackgroundColor3 = currentTheme.Surface,
            AutoButtonColor = false,
            Font = Enum.Font.Gotham,
            Text = "",
            Size = UDim2.new(0, 200, 0, 44)
        })
        local btnCorner = new("UICorner", {CornerRadius = UDim.new(0, 8), Parent = tabBtn})

        -- Ícone
        if icon then
            local iconLabel = new("ImageLabel", {
                Parent = tabBtn,
                BackgroundTransparency = 1,
                Image = icon,
                ImageColor3 = currentTheme.TextSecondary,
                Size = UDim2.new(0, 24, 0, 24),
                Position = UDim2.new(0, 12, 0.5, -12)
            })
        end

        local btnText = new("TextLabel", {
            Parent = tabBtn,
            BackgroundTransparency = 1,
            Font = Enum.Font.Gotham,
            Text = name,
            TextColor3 = currentTheme.TextSecondary,
            TextSize = 16,
            Position = icon and UDim2.new(0, 44, 0, 0) or UDim2.new(0, 16, 0, 0),
            Size = UDim2.new(1, -50, 1, 0),
            TextXAlignment = Enum.TextXAlignment.Left
        })

        local page = new("ScrollingFrame", {
            Parent = content,
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            Size = UDim2.new(1, -20, 1, -70),
            Position = UDim2.new(0, 10, 0, 68),
            CanvasSize = UDim2.new(0, 0, 0, 0),
            ScrollBarThickness = 4,
            ScrollBarImageColor3 = currentTheme.Secondary,
            Visible = false,
            BottomImage = "rbxasset://textures/ui/Scroll/scroll-middle.png",
            TopImage = "rbxasset://textures/ui/Scroll/scroll-middle.png",
            MidImage = "rbxasset://textures/ui/Scroll/scroll-middle.png"
        })
        local pageLayout = new("UIListLayout", {
            Parent = page,
            FillDirection = Enum.FillDirection.Vertical,
            HorizontalAlignment = Enum.HorizontalAlignment.Center,
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 12)
        })
        local pagePadding = new("UIPadding", {Parent = page, PaddingLeft = UDim.new(0, 12), PaddingRight = UDim.new(0, 12), PaddingTop = UDim.new(0, 12), PaddingBottom = UDim.new(0, 12)})

        local function updateCanvas()
            page.CanvasSize = UDim2.new(0, 0, 0, pageLayout.AbsoluteContentSize.Y + 24)
        end
        pageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateCanvas)

        if not currentPage then
            currentPage = page
            page.Visible = true
            tabBtn.BackgroundColor3 = currentTheme.Primary
            btnText.TextColor3 = Color3.fromRGB(255,255,255)
            if icon then
                tabBtn:FindFirstChildOfClass("ImageLabel").ImageColor3 = Color3.fromRGB(255,255,255)
            end
            headerTitle.Text = name
        end

        tabBtn.MouseButton1Click:Connect(function()
            if currentPage then currentPage.Visible = false end
            for _, btn in ipairs(sidebar:GetChildren()) do
                if btn:IsA("TextButton") then
                    btn.BackgroundColor3 = currentTheme.Surface
                    local text = btn:FindFirstChildOfClass("TextLabel")
                    if text then text.TextColor3 = currentTheme.TextSecondary end
                    local ico = btn:FindFirstChildOfClass("ImageLabel")
                    if ico then ico.ImageColor3 = currentTheme.TextSecondary end
                end
            end
            tabBtn.BackgroundColor3 = currentTheme.Primary
            btnText.TextColor3 = Color3.fromRGB(255,255,255)
            if icon then
                tabBtn:FindFirstChildOfClass("ImageLabel").ImageColor3 = Color3.fromRGB(255,255,255)
            end
            page.Visible = true
            currentPage = page
            headerTitle.Text = name
        end)

        -- Elementos da página
        local pageElements = {}

        function pageElements:AddCard(title)
            local card = new("Frame", {
                Parent = page,
                BackgroundColor3 = currentTheme.Surface,
                BorderSizePixel = 0,
                Size = UDim2.new(1, 0, 0, 0),
                AutomaticSize = Enum.AutomaticSize.Y
            })
            local cardCorner = new("UICorner", {CornerRadius = UDim.new(0, 8), Parent = card})
            local cardPadding = new("UIPadding", {Parent = card, PaddingLeft = UDim.new(0, 16), PaddingRight = UDim.new(0, 16), PaddingTop = UDim.new(0, 16), PaddingBottom = UDim.new(0, 16)})

            if title then
                local titleLabel = new("TextLabel", {
                    Parent = card,
                    BackgroundTransparency = 1,
                    Font = Enum.Font.GothamSemibold,
                    Text = title,
                    TextColor3 = currentTheme.Text,
                    TextSize = 18,
                    Size = UDim2.new(1, 0, 0, 30),
                    TextXAlignment = Enum.TextXAlignment.Left
                })
            end

            local layout = new("UIListLayout", {
                Parent = card,
                FillDirection = Enum.FillDirection.Vertical,
                HorizontalAlignment = Enum.HorizontalAlignment.Center,
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = UDim.new(0, 12)
            })

            -- Retorna funções para adicionar elementos dentro do card
            local cardElements = {}
            function cardElements:AddButton(text, callback, style)
                local colors = {
                    primary = currentTheme.Primary,
                    secondary = currentTheme.Secondary,
                    success = currentTheme.Success,
                    danger = currentTheme.Danger
                }
                local bgColor = colors[style] or currentTheme.Primary
                local btn = new("TextButton", {
                    Parent = card,
                    BackgroundColor3 = bgColor,
                    AutoButtonColor = false,
                    Font = Enum.Font.Gotham,
                    Text = text,
                    TextColor3 = (style == "secondary" and currentTheme.Text) or Color3.fromRGB(255,255,255),
                    TextSize = 15,
                    Size = UDim2.new(1, 0, 0, 40)
                })
                local btnCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = btn})
                btn.MouseEnter:Connect(function()
                    TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = bgColor:Lerp(Color3.fromRGB(255,255,255), 0.2)}):Play()
                end)
                btn.MouseLeave:Connect(function()
                    TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = bgColor}):Play()
                end)
                btn.MouseButton1Click:Connect(function()
                    safeCallback(callback)
                end)
                updateCanvas()
            end

            function cardElements:AddToggle(text, default, callback)
                local toggled = default or false
                local frame = new("Frame", {
                    Parent = card,
                    BackgroundColor3 = currentTheme.Surface,
                    BorderSizePixel = 0,
                    Size = UDim2.new(1, 0, 0, 44),
                    AutomaticSize = Enum.AutomaticSize.Y
                })
                local label = new("TextLabel", {
                    Parent = frame,
                    BackgroundTransparency = 1,
                    Font = Enum.Font.Gotham,
                    Text = text,
                    TextColor3 = currentTheme.Text,
                    TextSize = 15,
                    Position = UDim2.new(0, 0, 0, 12),
                    Size = UDim2.new(0, 200, 0, 20),
                    TextXAlignment = Enum.TextXAlignment.Left
                })
                local toggleBtn = new("TextButton", {
                    Parent = frame,
                    BackgroundColor3 = toggled and currentTheme.Success or currentTheme.Secondary,
                    AutoButtonColor = false,
                    Text = "",
                    Position = UDim2.new(1, -50, 0.5, -12),
                    Size = UDim2.new(0, 44, 0, 24)
                })
                local toggleCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = toggleBtn})
                local circle = new("Frame", {
                    Parent = toggleBtn,
                    BackgroundColor3 = Color3.fromRGB(255,255,255),
                    Position = toggled and UDim2.new(1, -22, 0.5, -9) or UDim2.new(0, 2, 0.5, -9),
                    Size = UDim2.new(0, 18, 0, 18)
                })
                local circleCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = circle})
                toggleBtn.MouseButton1Click:Connect(function()
                    toggled = not toggled
                    TweenService:Create(toggleBtn, TweenInfo.new(0.2), {BackgroundColor3 = toggled and currentTheme.Success or currentTheme.Secondary}):Play()
                    TweenService:Create(circle, TweenInfo.new(0.2), {Position = toggled and UDim2.new(1, -22, 0.5, -9) or UDim2.new(0, 2, 0.5, -9)}):Play()
                    safeCallback(callback, toggled)
                end)
                frame.Size = UDim2.new(1, 0, 0, 48)
                updateCanvas()
            end

            function cardElements:AddSlider(text, min, max, default, callback)
                local value = default or min
                local dragging = false
                local frame = new("Frame", {
                    Parent = card,
                    BackgroundColor3 = currentTheme.Surface,
                    BorderSizePixel = 0,
                    Size = UDim2.new(1, 0, 0, 70),
                    AutomaticSize = Enum.AutomaticSize.Y
                })
                local label = new("TextLabel", {
                    Parent = frame,
                    BackgroundTransparency = 1,
                    Font = Enum.Font.Gotham,
                    Text = text,
                    TextColor3 = currentTheme.Text,
                    TextSize = 15,
                    Position = UDim2.new(0, 0, 0, 12),
                    Size = UDim2.new(0, 200, 0, 20),
                    TextXAlignment = Enum.TextXAlignment.Left
                })
                local valueLabel = new("TextLabel", {
                    Parent = frame,
                    BackgroundTransparency = 1,
                    Font = Enum.Font.Gotham,
                    Text = tostring(value),
                    TextColor3 = currentTheme.TextSecondary,
                    TextSize = 14,
                    Position = UDim2.new(1, -40, 0, 12),
                    Size = UDim2.new(0, 40, 0, 20),
                    TextXAlignment = Enum.TextXAlignment.Right
                })
                local sliderBg = new("Frame", {
                    Parent = frame,
                    BackgroundColor3 = currentTheme.Secondary,
                    BorderSizePixel = 0,
                    Position = UDim2.new(0, 0, 0, 44),
                    Size = UDim2.new(1, 0, 0, 6)
                })
                local sliderBgCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = sliderBg})
                local fill = new("Frame", {
                    Parent = sliderBg,
                    BackgroundColor3 = currentTheme.Primary,
                    BorderSizePixel = 0,
                    Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
                })
                local fillCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = fill})
                local knob = new("TextButton", {
                    Parent = sliderBg,
                    BackgroundColor3 = Color3.fromRGB(255,255,255),
                    Text = "",
                    Position = UDim2.new((value - min) / (max - min), -8, 0.5, -8),
                    Size = UDim2.new(0, 16, 0, 16)
                })
                local knobCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = knob})
                knob.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        dragging = true
                    end
                end)
                knob.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        dragging = false
                    end
                end)
                local function update(input)
                    local pos = math.clamp((input.Position.X - sliderBg.AbsolutePosition.X) / sliderBg.AbsoluteSize.X, 0, 1)
                    value = math.floor(min + (max - min) * pos)
                    fill:TweenSize(UDim2.new(pos, 0, 1, 0), "Out", "Quad", 0.1, true)
                    knob:TweenPosition(UDim2.new(pos, -8, 0.5, -8), "Out", "Quad", 0.1, true)
                    valueLabel.Text = tostring(value)
                    safeCallback(callback, value)
                end
                UserInputService.InputChanged:Connect(function(input)
                    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                        update(input)
                    end
                end)
                frame.Size = UDim2.new(1, 0, 0, 80)
                updateCanvas()
            end

            function cardElements:AddDropdown(text, options, callback)
                local selected = text
                local expanded = false
                local frame = new("Frame", {
                    Parent = card,
                    BackgroundColor3 = currentTheme.Surface,
                    BorderSizePixel = 0,
                    Size = UDim2.new(1, 0, 0, 44),
                    AutomaticSize = Enum.AutomaticSize.Y
                })
                local label = new("TextLabel", {
                    Parent = frame,
                    BackgroundTransparency = 1,
                    Font = Enum.Font.Gotham,
                    Text = text,
                    TextColor3 = currentTheme.Text,
                    TextSize = 15,
                    Position = UDim2.new(0, 0, 0, 12),
                    Size = UDim2.new(0, 200, 0, 20),
                    TextXAlignment = Enum.TextXAlignment.Left
                })
                local arrow = new("ImageLabel", {
                    Parent = frame,
                    BackgroundTransparency = 1,
                    Image = "rbxassetid://6034818372",
                    ImageColor3 = currentTheme.TextSecondary,
                    Size = UDim2.new(0, 16, 0, 16),
                    Position = UDim2.new(1, -20, 0, 14)
                })
                local dropdownBtn = new("TextButton", {
                    Parent = frame,
                    BackgroundTransparency = 1,
                    Text = "",
                    Size = UDim2.new(1, 0, 1, 0)
                })
                local dropdownContainer = new("Frame", {
                    Parent = card,
                    BackgroundColor3 = currentTheme.Surface,
                    BorderSizePixel = 0,
                    Position = UDim2.new(0, 0, 0, frame.AbsolutePosition.Y + 52),
                    Size = UDim2.new(1, 0, 0, 0),
                    Visible = false,
                    ClipsDescendants = true,
                    ZIndex = 5
                })
                local containerCorner = new("UICorner", {CornerRadius = UDim.new(0, 8), Parent = dropdownContainer})
                local dropdownList = new("UIListLayout", {Parent = dropdownContainer, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 2)})
                local dropdownPadding = new("UIPadding", {Parent = dropdownContainer, PaddingLeft = UDim.new(0, 8), PaddingRight = UDim.new(0, 8), PaddingTop = UDim.new(0, 8), PaddingBottom = UDim.new(0, 8)})

                for _, opt in ipairs(options) do
                    local optBtn = new("TextButton", {
                        Parent = dropdownContainer,
                        BackgroundColor3 = currentTheme.Surface,
                        AutoButtonColor = false,
                        Font = Enum.Font.Gotham,
                        Text = opt,
                        TextColor3 = currentTheme.TextSecondary,
                        TextSize = 14,
                        Size = UDim2.new(1, 0, 0, 30)
                    })
                    optBtn.MouseButton1Click:Connect(function()
                        selected = opt
                        label.Text = text .. ": " .. opt
                        expanded = false
                        dropdownContainer.Visible = false
                        arrow.Rotation = 0
                        safeCallback(callback, opt)
                        updateCanvas()
                    end)
                end

                dropdownBtn.MouseButton1Click:Connect(function()
                    expanded = not expanded
                    local height = math.min(#options * 32 + 16, 200)
                    if expanded then
                        frame.Size = UDim2.new(1, 0, 0, 44 + height)
                        dropdownContainer.Size = UDim2.new(1, 0, 0, height)
                        dropdownContainer.Visible = true
                        arrow.Rotation = 180
                    else
                        frame.Size = UDim2.new(1, 0, 0, 44)
                        dropdownContainer.Visible = false
                        arrow.Rotation = 0
                    end
                    updateCanvas()
                end)
                updateCanvas()
            end

            function cardElements:AddTextbox(text, placeholder, callback, multiline)
                local frame = new("Frame", {
                    Parent = card,
                    BackgroundColor3 = currentTheme.Surface,
                    BorderSizePixel = 0,
                    Size = UDim2.new(1, 0, 0, 70),
                    AutomaticSize = Enum.AutomaticSize.Y
                })
                local label = new("TextLabel", {
                    Parent = frame,
                    BackgroundTransparency = 1,
                    Font = Enum.Font.Gotham,
                    Text = text,
                    TextColor3 = currentTheme.Text,
                    TextSize = 15,
                    Position = UDim2.new(0, 0, 0, 12),
                    Size = UDim2.new(0, 200, 0, 20),
                    TextXAlignment = Enum.TextXAlignment.Left
                })
                local boxFrame = new("Frame", {
                    Parent = frame,
                    BackgroundColor3 = currentTheme.Secondary,
                    BorderSizePixel = 0,
                    Position = UDim2.new(0, 0, 0, 40),
                    Size = UDim2.new(1, 0, 0, multiline and 60 or 30)
                })
                local boxCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = boxFrame})
                local textBox = new("TextBox", {
                    Parent = boxFrame,
                    BackgroundTransparency = 1,
                    Font = Enum.Font.Gotham,
                    PlaceholderText = placeholder,
                    PlaceholderColor3 = currentTheme.TextSecondary,
                    Text = "",
                    TextColor3 = currentTheme.Text,
                    TextSize = 14,
                    Size = UDim2.new(1, -12, 1, 0),
                    Position = UDim2.new(0, 6, 0, 0),
                    ClearTextOnFocus = false,
                    MultiLine = multiline or false
                })
                textBox.FocusLost:Connect(function(enterPressed)
                    if enterPressed then
                        safeCallback(callback, textBox.Text)
                    end
                end)
                frame.Size = UDim2.new(1, 0, 0, multiline and 110 or 80)
                updateCanvas()
            end

            function cardElements:AddLabel(text, size)
                local label = new("TextLabel", {
                    Parent = card,
                    BackgroundTransparency = 1,
                    Font = Enum.Font.Gotham,
                    Text = text,
                    TextColor3 = currentTheme.TextSecondary,
                    TextSize = size or 14,
                    Size = UDim2.new(1, 0, 0, 20)
                })
                updateCanvas()
            end

            function cardElements:AddSeparator()
                local sep = new("Frame", {
                    Parent = card,
                    BackgroundColor3 = currentTheme.Border,
                    BorderSizePixel = 0,
                    Size = UDim2.new(1, 0, 0, 1)
                })
                updateCanvas()
            end

            return cardElements
        end

        -- Elementos diretamente na página (sem card)
        function pageElements:AddButton(text, callback, style)
            local colors = {
                primary = currentTheme.Primary,
                secondary = currentTheme.Secondary,
                success = currentTheme.Success,
                danger = currentTheme.Danger
            }
            local bgColor = colors[style] or currentTheme.Primary
            local btn = new("TextButton", {
                Parent = page,
                BackgroundColor3 = bgColor,
                AutoButtonColor = false,
                Font = Enum.Font.Gotham,
                Text = text,
                TextColor3 = (style == "secondary" and currentTheme.Text) or Color3.fromRGB(255,255,255),
                TextSize = 15,
                Size = UDim2.new(1, 0, 0, 40)
            })
            local btnCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = btn})
            btn.MouseEnter:Connect(function()
                TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = bgColor:Lerp(Color3.fromRGB(255,255,255), 0.2)}):Play()
            end)
            btn.MouseLeave:Connect(function()
                TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = bgColor}):Play()
            end)
            btn.MouseButton1Click:Connect(function()
                safeCallback(callback)
            end)
            updateCanvas()
        end

        function pageElements:AddToggle(text, default, callback)
            local toggled = default or false
            local frame = new("Frame", {
                Parent = page,
                BackgroundColor3 = currentTheme.Surface,
                BorderSizePixel = 0,
                Size = UDim2.new(1, 0, 0, 44),
                AutomaticSize = Enum.AutomaticSize.Y
            })
            local frameCorner = new("UICorner", {CornerRadius = UDim.new(0, 8), Parent = frame})
            local padding = new("UIPadding", {Parent = frame, PaddingLeft = UDim.new(0, 16), PaddingRight = UDim.new(0, 16)})

            local label = new("TextLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Font = Enum.Font.Gotham,
                Text = text,
                TextColor3 = currentTheme.Text,
                TextSize = 15,
                Position = UDim2.new(0, 0, 0, 12),
                Size = UDim2.new(0, 200, 0, 20),
                TextXAlignment = Enum.TextXAlignment.Left
            })
            local toggleBtn = new("TextButton", {
                Parent = frame,
                BackgroundColor3 = toggled and currentTheme.Success or currentTheme.Secondary,
                AutoButtonColor = false,
                Text = "",
                Position = UDim2.new(1, -50, 0.5, -12),
                Size = UDim2.new(0, 44, 0, 24)
            })
            local toggleCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = toggleBtn})
            local circle = new("Frame", {
                Parent = toggleBtn,
                BackgroundColor3 = Color3.fromRGB(255,255,255),
                Position = toggled and UDim2.new(1, -22, 0.5, -9) or UDim2.new(0, 2, 0.5, -9),
                Size = UDim2.new(0, 18, 0, 18)
            })
            local circleCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = circle})
            toggleBtn.MouseButton1Click:Connect(function()
                toggled = not toggled
                TweenService:Create(toggleBtn, TweenInfo.new(0.2), {BackgroundColor3 = toggled and currentTheme.Success or currentTheme.Secondary}):Play()
                TweenService:Create(circle, TweenInfo.new(0.2), {Position = toggled and UDim2.new(1, -22, 0.5, -9) or UDim2.new(0, 2, 0.5, -9)}):Play()
                safeCallback(callback, toggled)
            end)
            updateCanvas()
        end

        function pageElements:AddSlider(text, min, max, default, callback)
            local value = default or min
            local dragging = false
            local frame = new("Frame", {
                Parent = page,
                BackgroundColor3 = currentTheme.Surface,
                BorderSizePixel = 0,
                Size = UDim2.new(1, 0, 0, 80),
                AutomaticSize = Enum.AutomaticSize.Y
            })
            local frameCorner = new("UICorner", {CornerRadius = UDim.new(0, 8), Parent = frame})
            local padding = new("UIPadding", {Parent = frame, PaddingLeft = UDim.new(0, 16), PaddingRight = UDim.new(0, 16)})

            local label = new("TextLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Font = Enum.Font.Gotham,
                Text = text,
                TextColor3 = currentTheme.Text,
                TextSize = 15,
                Position = UDim2.new(0, 0, 0, 12),
                Size = UDim2.new(0, 200, 0, 20),
                TextXAlignment = Enum.TextXAlignment.Left
            })
            local valueLabel = new("TextLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Font = Enum.Font.Gotham,
                Text = tostring(value),
                TextColor3 = currentTheme.TextSecondary,
                TextSize = 14,
                Position = UDim2.new(1, -40, 0, 12),
                Size = UDim2.new(0, 40, 0, 20),
                TextXAlignment = Enum.TextXAlignment.Right
            })
            local sliderBg = new("Frame", {
                Parent = frame,
                BackgroundColor3 = currentTheme.Secondary,
                BorderSizePixel = 0,
                Position = UDim2.new(0, 0, 0, 44),
                Size = UDim2.new(1, 0, 0, 6)
            })
            local sliderBgCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = sliderBg})
            local fill = new("Frame", {
                Parent = sliderBg,
                BackgroundColor3 = currentTheme.Primary,
                BorderSizePixel = 0,
                Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
            })
            local fillCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = fill})
            local knob = new("TextButton", {
                Parent = sliderBg,
                BackgroundColor3 = Color3.fromRGB(255,255,255),
                Text = "",
                Position = UDim2.new((value - min) / (max - min), -8, 0.5, -8),
                Size = UDim2.new(0, 16, 0, 16)
            })
            local knobCorner = new("UICorner", {CornerRadius = UDim.new(1, 0), Parent = knob})
            knob.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = true
                end
            end)
            knob.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = false
                end
            end)
            local function update(input)
                local pos = math.clamp((input.Position.X - sliderBg.AbsolutePosition.X) / sliderBg.AbsoluteSize.X, 0, 1)
                value = math.floor(min + (max - min) * pos)
                fill:TweenSize(UDim2.new(pos, 0, 1, 0), "Out", "Quad", 0.1, true)
                knob:TweenPosition(UDim2.new(pos, -8, 0.5, -8), "Out", "Quad", 0.1, true)
                valueLabel.Text = tostring(value)
                safeCallback(callback, value)
            end
            UserInputService.InputChanged:Connect(function(input)
                if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    update(input)
                end
            end)
            updateCanvas()
        end

        function pageElements:AddDropdown(text, options, callback)
            local selected = text
            local expanded = false
            local frame = new("Frame", {
                Parent = page,
                BackgroundColor3 = currentTheme.Surface,
                BorderSizePixel = 0,
                Size = UDim2.new(1, 0, 0, 44),
                AutomaticSize = Enum.AutomaticSize.Y
            })
            local frameCorner = new("UICorner", {CornerRadius = UDim.new(0, 8), Parent = frame})
            local padding = new("UIPadding", {Parent = frame, PaddingLeft = UDim.new(0, 16), PaddingRight = UDim.new(0, 16)})

            local label = new("TextLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Font = Enum.Font.Gotham,
                Text = text,
                TextColor3 = currentTheme.Text,
                TextSize = 15,
                Position = UDim2.new(0, 0, 0, 12),
                Size = UDim2.new(0, 200, 0, 20),
                TextXAlignment = Enum.TextXAlignment.Left
            })
            local arrow = new("ImageLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Image = "rbxassetid://6034818372",
                ImageColor3 = currentTheme.TextSecondary,
                Size = UDim2.new(0, 16, 0, 16),
                Position = UDim2.new(1, -20, 0, 14)
            })
            local dropdownBtn = new("TextButton", {
                Parent = frame,
                BackgroundTransparency = 1,
                Text = "",
                Size = UDim2.new(1, 0, 1, 0)
            })
            local dropdownContainer = new("Frame", {
                Parent = page,
                BackgroundColor3 = currentTheme.Surface,
                BorderSizePixel = 0,
                Position = UDim2.new(0, 0, 0, frame.AbsolutePosition.Y + 52),
                Size = UDim2.new(1, 0, 0, 0),
                Visible = false,
                ClipsDescendants = true,
                ZIndex = 5
            })
            local containerCorner = new("UICorner", {CornerRadius = UDim.new(0, 8), Parent = dropdownContainer})
            local dropdownList = new("UIListLayout", {Parent = dropdownContainer, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 2)})
            local dropdownPadding = new("UIPadding", {Parent = dropdownContainer, PaddingLeft = UDim.new(0, 8), PaddingRight = UDim.new(0, 8), PaddingTop = UDim.new(0, 8), PaddingBottom = UDim.new(0, 8)})

            for _, opt in ipairs(options) do
                local optBtn = new("TextButton", {
                    Parent = dropdownContainer,
                    BackgroundColor3 = currentTheme.Surface,
                    AutoButtonColor = false,
                    Font = Enum.Font.Gotham,
                    Text = opt,
                    TextColor3 = currentTheme.TextSecondary,
                    TextSize = 14,
                    Size = UDim2.new(1, 0, 0, 30)
                })
                optBtn.MouseButton1Click:Connect(function()
                    selected = opt
                    label.Text = text .. ": " .. opt
                    expanded = false
                    dropdownContainer.Visible = false
                    arrow.Rotation = 0
                    safeCallback(callback, opt)
                    updateCanvas()
                end)
            end

            dropdownBtn.MouseButton1Click:Connect(function()
                expanded = not expanded
                local height = math.min(#options * 32 + 16, 200)
                if expanded then
                    frame.Size = UDim2.new(1, 0, 0, 44 + height)
                    dropdownContainer.Size = UDim2.new(1, 0, 0, height)
                    dropdownContainer.Visible = true
                    arrow.Rotation = 180
                else
                    frame.Size = UDim2.new(1, 0, 0, 44)
                    dropdownContainer.Visible = false
                    arrow.Rotation = 0
                end
                updateCanvas()
            end)
            updateCanvas()
        end

        function pageElements:AddTextbox(text, placeholder, callback, multiline)
            local frame = new("Frame", {
                Parent = page,
                BackgroundColor3 = currentTheme.Surface,
                BorderSizePixel = 0,
                Size = UDim2.new(1, 0, 0, multiline and 110 or 80),
                AutomaticSize = Enum.AutomaticSize.Y
            })
            local frameCorner = new("UICorner", {CornerRadius = UDim.new(0, 8), Parent = frame})
            local padding = new("UIPadding", {Parent = frame, PaddingLeft = UDim.new(0, 16), PaddingRight = UDim.new(0, 16)})

            local label = new("TextLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Font = Enum.Font.Gotham,
                Text = text,
                TextColor3 = currentTheme.Text,
                TextSize = 15,
                Position = UDim2.new(0, 0, 0, 12),
                Size = UDim2.new(0, 200, 0, 20),
                TextXAlignment = Enum.TextXAlignment.Left
            })
            local boxFrame = new("Frame", {
                Parent = frame,
                BackgroundColor3 = currentTheme.Secondary,
                BorderSizePixel = 0,
                Position = UDim2.new(0, 0, 0, 40),
                Size = UDim2.new(1, 0, 0, multiline and 60 or 30)
            })
            local boxCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = boxFrame})
            local textBox = new("TextBox", {
                Parent = boxFrame,
                BackgroundTransparency = 1,
                Font = Enum.Font.Gotham,
                PlaceholderText = placeholder,
                PlaceholderColor3 = currentTheme.TextSecondary,
                Text = "",
                TextColor3 = currentTheme.Text,
                TextSize = 14,
                Size = UDim2.new(1, -12, 1, 0),
                Position = UDim2.new(0, 6, 0, 0),
                ClearTextOnFocus = false,
                MultiLine = multiline or false
            })
            textBox.FocusLost:Connect(function(enterPressed)
                if enterPressed then
                    safeCallback(callback, textBox.Text)
                end
            end)
            updateCanvas()
        end

        function pageElements:AddLabel(text, size)
            local label = new("TextLabel", {
                Parent = page,
                BackgroundColor3 = currentTheme.Surface,
                Font = Enum.Font.Gotham,
                Text = text,
                TextColor3 = currentTheme.Text,
                TextSize = size or 14,
                Size = UDim2.new(1, 0, 0, 30)
            })
            local labelCorner = new("UICorner", {CornerRadius = UDim.new(0, 6), Parent = label})
            updateCanvas()
        end

        function pageElements:AddSeparator()
            local sep = new("Frame", {
                Parent = page,
                BackgroundColor3 = currentTheme.Border,
                BorderSizePixel = 0,
                Size = UDim2.new(1, 0, 0, 1)
            })
            updateCanvas()
        end

        return pageElements
    end

    return {
        AddTab = tabs.AddTab,
        Notify = notify
    }
end

return AxiomXLib
